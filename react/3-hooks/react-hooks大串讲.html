<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react-hooks å¤§ä¸²è®² | note</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.webp">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="blog,react,node,js">
    
    <link rel="preload" href="/assets/css/0.styles.b4a844ec.css" as="style"><link rel="preload" href="/assets/js/app.447fea52.js" as="script"><link rel="preload" href="/assets/js/2.57da4f88.js" as="script"><link rel="preload" href="/assets/js/1.a76cc220.js" as="script"><link rel="preload" href="/assets/js/151.fc9a2f7e.js" as="script"><link rel="prefetch" href="/assets/js/10.50f73657.js"><link rel="prefetch" href="/assets/js/100.6be385a1.js"><link rel="prefetch" href="/assets/js/101.81462761.js"><link rel="prefetch" href="/assets/js/102.c8574913.js"><link rel="prefetch" href="/assets/js/103.edf4da17.js"><link rel="prefetch" href="/assets/js/104.957e299a.js"><link rel="prefetch" href="/assets/js/105.62db7699.js"><link rel="prefetch" href="/assets/js/106.5bb35c23.js"><link rel="prefetch" href="/assets/js/107.a7d99347.js"><link rel="prefetch" href="/assets/js/108.e5a534df.js"><link rel="prefetch" href="/assets/js/109.6cbde664.js"><link rel="prefetch" href="/assets/js/11.0390ceee.js"><link rel="prefetch" href="/assets/js/110.c26bacc8.js"><link rel="prefetch" href="/assets/js/111.9360a59a.js"><link rel="prefetch" href="/assets/js/112.8cd53094.js"><link rel="prefetch" href="/assets/js/113.d0ebeec4.js"><link rel="prefetch" href="/assets/js/114.ec19f01c.js"><link rel="prefetch" href="/assets/js/115.4d3a89e6.js"><link rel="prefetch" href="/assets/js/116.a2a462f7.js"><link rel="prefetch" href="/assets/js/117.722c988a.js"><link rel="prefetch" href="/assets/js/118.f713753b.js"><link rel="prefetch" href="/assets/js/119.0125b80b.js"><link rel="prefetch" href="/assets/js/12.f88bec36.js"><link rel="prefetch" href="/assets/js/120.cd8ba30b.js"><link rel="prefetch" href="/assets/js/121.4c137fcb.js"><link rel="prefetch" href="/assets/js/122.d242343d.js"><link rel="prefetch" href="/assets/js/123.cdd643cd.js"><link rel="prefetch" href="/assets/js/124.a166a490.js"><link rel="prefetch" href="/assets/js/125.91acf062.js"><link rel="prefetch" href="/assets/js/126.09c27dbc.js"><link rel="prefetch" href="/assets/js/127.0d254650.js"><link rel="prefetch" href="/assets/js/128.431a6444.js"><link rel="prefetch" href="/assets/js/129.421c57ef.js"><link rel="prefetch" href="/assets/js/13.963ad03b.js"><link rel="prefetch" href="/assets/js/130.f980bd2e.js"><link rel="prefetch" href="/assets/js/131.f5d4dec1.js"><link rel="prefetch" href="/assets/js/132.b5fe7c86.js"><link rel="prefetch" href="/assets/js/133.e21e8968.js"><link rel="prefetch" href="/assets/js/134.cfde36a7.js"><link rel="prefetch" href="/assets/js/135.e11bbca9.js"><link rel="prefetch" href="/assets/js/136.d29baf7d.js"><link rel="prefetch" href="/assets/js/137.0d102a51.js"><link rel="prefetch" href="/assets/js/138.53de572f.js"><link rel="prefetch" href="/assets/js/139.35296624.js"><link rel="prefetch" href="/assets/js/14.512f15b9.js"><link rel="prefetch" href="/assets/js/140.939a9838.js"><link rel="prefetch" href="/assets/js/141.a0dbf983.js"><link rel="prefetch" href="/assets/js/142.b79d2722.js"><link rel="prefetch" href="/assets/js/143.f59c2798.js"><link rel="prefetch" href="/assets/js/144.45695bae.js"><link rel="prefetch" href="/assets/js/145.be0d5407.js"><link rel="prefetch" href="/assets/js/146.4eeb3c90.js"><link rel="prefetch" href="/assets/js/147.13a97e91.js"><link rel="prefetch" href="/assets/js/148.a9cb8c8d.js"><link rel="prefetch" href="/assets/js/149.3f1dd92d.js"><link rel="prefetch" href="/assets/js/15.a674496c.js"><link rel="prefetch" href="/assets/js/150.56dd1be8.js"><link rel="prefetch" href="/assets/js/152.53bd3a44.js"><link rel="prefetch" href="/assets/js/153.5607c16e.js"><link rel="prefetch" href="/assets/js/154.ad730ace.js"><link rel="prefetch" href="/assets/js/155.57d2a2cb.js"><link rel="prefetch" href="/assets/js/156.a092fa0e.js"><link rel="prefetch" href="/assets/js/157.966a0773.js"><link rel="prefetch" href="/assets/js/158.04bf03ea.js"><link rel="prefetch" href="/assets/js/159.33574240.js"><link rel="prefetch" href="/assets/js/16.ed7e507f.js"><link rel="prefetch" href="/assets/js/160.cee6d2e8.js"><link rel="prefetch" href="/assets/js/161.45a39d07.js"><link rel="prefetch" href="/assets/js/162.f40c82ce.js"><link rel="prefetch" href="/assets/js/163.a8c1cfc2.js"><link rel="prefetch" href="/assets/js/164.d57c2637.js"><link rel="prefetch" href="/assets/js/165.44596485.js"><link rel="prefetch" href="/assets/js/166.989571e6.js"><link rel="prefetch" href="/assets/js/167.d50ff3ee.js"><link rel="prefetch" href="/assets/js/168.6035f621.js"><link rel="prefetch" href="/assets/js/169.330a08ba.js"><link rel="prefetch" href="/assets/js/17.de667ca5.js"><link rel="prefetch" href="/assets/js/170.9f889b63.js"><link rel="prefetch" href="/assets/js/171.8cf81cba.js"><link rel="prefetch" href="/assets/js/172.f0d70990.js"><link rel="prefetch" href="/assets/js/173.ea277ff7.js"><link rel="prefetch" href="/assets/js/174.4a3a3c49.js"><link rel="prefetch" href="/assets/js/175.cea93f7c.js"><link rel="prefetch" href="/assets/js/176.5dd9d8fc.js"><link rel="prefetch" href="/assets/js/177.02903ac2.js"><link rel="prefetch" href="/assets/js/178.46bd7e6a.js"><link rel="prefetch" href="/assets/js/179.e69ff40a.js"><link rel="prefetch" href="/assets/js/18.b44e84af.js"><link rel="prefetch" href="/assets/js/180.710c8f29.js"><link rel="prefetch" href="/assets/js/181.8069e76c.js"><link rel="prefetch" href="/assets/js/182.4c34a2bf.js"><link rel="prefetch" href="/assets/js/183.46c4777e.js"><link rel="prefetch" href="/assets/js/184.efb2e0ea.js"><link rel="prefetch" href="/assets/js/185.f18ec0c0.js"><link rel="prefetch" href="/assets/js/186.23f2ac84.js"><link rel="prefetch" href="/assets/js/187.3b612006.js"><link rel="prefetch" href="/assets/js/188.5a59c9aa.js"><link rel="prefetch" href="/assets/js/189.cecf5612.js"><link rel="prefetch" href="/assets/js/19.5b5ad6a1.js"><link rel="prefetch" href="/assets/js/190.fefddc0e.js"><link rel="prefetch" href="/assets/js/191.e4bb534f.js"><link rel="prefetch" href="/assets/js/192.d724ea09.js"><link rel="prefetch" href="/assets/js/193.89dfe351.js"><link rel="prefetch" href="/assets/js/194.eae77bb4.js"><link rel="prefetch" href="/assets/js/195.04c629f4.js"><link rel="prefetch" href="/assets/js/196.1d478ed9.js"><link rel="prefetch" href="/assets/js/197.c1d0596a.js"><link rel="prefetch" href="/assets/js/198.16c3a6e0.js"><link rel="prefetch" href="/assets/js/199.d7abc746.js"><link rel="prefetch" href="/assets/js/20.6800493a.js"><link rel="prefetch" href="/assets/js/200.d0333b05.js"><link rel="prefetch" href="/assets/js/201.b004c4b0.js"><link rel="prefetch" href="/assets/js/202.2bdcfdad.js"><link rel="prefetch" href="/assets/js/203.3d4404c8.js"><link rel="prefetch" href="/assets/js/204.6811f526.js"><link rel="prefetch" href="/assets/js/205.dbe839ca.js"><link rel="prefetch" href="/assets/js/206.cf281ab8.js"><link rel="prefetch" href="/assets/js/207.b30ec93b.js"><link rel="prefetch" href="/assets/js/208.5bd20623.js"><link rel="prefetch" href="/assets/js/209.08173f53.js"><link rel="prefetch" href="/assets/js/21.6589052c.js"><link rel="prefetch" href="/assets/js/210.fc083767.js"><link rel="prefetch" href="/assets/js/211.a40c0012.js"><link rel="prefetch" href="/assets/js/212.ad79a40d.js"><link rel="prefetch" href="/assets/js/213.05dfd83a.js"><link rel="prefetch" href="/assets/js/214.d9155fcb.js"><link rel="prefetch" href="/assets/js/215.1884162c.js"><link rel="prefetch" href="/assets/js/216.d7e400c0.js"><link rel="prefetch" href="/assets/js/22.f648d829.js"><link rel="prefetch" href="/assets/js/23.1898021f.js"><link rel="prefetch" href="/assets/js/24.c498cdc9.js"><link rel="prefetch" href="/assets/js/25.2cf0f1ab.js"><link rel="prefetch" href="/assets/js/26.4b576a28.js"><link rel="prefetch" href="/assets/js/27.48016cde.js"><link rel="prefetch" href="/assets/js/28.fab602ac.js"><link rel="prefetch" href="/assets/js/29.2daa3972.js"><link rel="prefetch" href="/assets/js/3.13e892f5.js"><link rel="prefetch" href="/assets/js/30.495325df.js"><link rel="prefetch" href="/assets/js/31.257c7222.js"><link rel="prefetch" href="/assets/js/32.ef7a504e.js"><link rel="prefetch" href="/assets/js/33.bc231dd7.js"><link rel="prefetch" href="/assets/js/34.55a39391.js"><link rel="prefetch" href="/assets/js/35.3c4d8e9c.js"><link rel="prefetch" href="/assets/js/36.4557224c.js"><link rel="prefetch" href="/assets/js/37.e9a90f7d.js"><link rel="prefetch" href="/assets/js/38.25785bc2.js"><link rel="prefetch" href="/assets/js/39.eea4fa35.js"><link rel="prefetch" href="/assets/js/4.5bdb9365.js"><link rel="prefetch" href="/assets/js/40.b213be66.js"><link rel="prefetch" href="/assets/js/41.ab652ab8.js"><link rel="prefetch" href="/assets/js/42.a05627ab.js"><link rel="prefetch" href="/assets/js/43.f53f1b1d.js"><link rel="prefetch" href="/assets/js/44.5bb97f6d.js"><link rel="prefetch" href="/assets/js/45.4b41539d.js"><link rel="prefetch" href="/assets/js/46.1ac7cc3f.js"><link rel="prefetch" href="/assets/js/47.0580f030.js"><link rel="prefetch" href="/assets/js/48.b0904b52.js"><link rel="prefetch" href="/assets/js/49.7ce5240a.js"><link rel="prefetch" href="/assets/js/5.7c68fdb5.js"><link rel="prefetch" href="/assets/js/50.c3d83fd2.js"><link rel="prefetch" href="/assets/js/51.ba60fa98.js"><link rel="prefetch" href="/assets/js/52.7b2d060b.js"><link rel="prefetch" href="/assets/js/53.34682882.js"><link rel="prefetch" href="/assets/js/54.36faf575.js"><link rel="prefetch" href="/assets/js/55.054b9174.js"><link rel="prefetch" href="/assets/js/56.341e473a.js"><link rel="prefetch" href="/assets/js/57.f2277797.js"><link rel="prefetch" href="/assets/js/58.13a608e8.js"><link rel="prefetch" href="/assets/js/59.7d091c83.js"><link rel="prefetch" href="/assets/js/6.c8da7ca7.js"><link rel="prefetch" href="/assets/js/60.97bfc772.js"><link rel="prefetch" href="/assets/js/61.1c93e74f.js"><link rel="prefetch" href="/assets/js/62.3a202bb4.js"><link rel="prefetch" href="/assets/js/63.20335462.js"><link rel="prefetch" href="/assets/js/64.3b00af96.js"><link rel="prefetch" href="/assets/js/65.6a30f1ee.js"><link rel="prefetch" href="/assets/js/66.98d9d390.js"><link rel="prefetch" href="/assets/js/67.0864c47b.js"><link rel="prefetch" href="/assets/js/68.158bb649.js"><link rel="prefetch" href="/assets/js/69.7693303c.js"><link rel="prefetch" href="/assets/js/7.e4c88d0e.js"><link rel="prefetch" href="/assets/js/70.8b2a4075.js"><link rel="prefetch" href="/assets/js/71.a152429d.js"><link rel="prefetch" href="/assets/js/72.1ea49d1e.js"><link rel="prefetch" href="/assets/js/73.58e400b1.js"><link rel="prefetch" href="/assets/js/74.89658617.js"><link rel="prefetch" href="/assets/js/75.e4eca339.js"><link rel="prefetch" href="/assets/js/76.5ae0023e.js"><link rel="prefetch" href="/assets/js/77.b58d5308.js"><link rel="prefetch" href="/assets/js/78.4efde4e8.js"><link rel="prefetch" href="/assets/js/79.fcdba4f6.js"><link rel="prefetch" href="/assets/js/80.8fe0bd7d.js"><link rel="prefetch" href="/assets/js/81.06afa735.js"><link rel="prefetch" href="/assets/js/82.c078b99d.js"><link rel="prefetch" href="/assets/js/83.b17bc157.js"><link rel="prefetch" href="/assets/js/84.22e70000.js"><link rel="prefetch" href="/assets/js/85.7e56ce9f.js"><link rel="prefetch" href="/assets/js/86.ec79f7c8.js"><link rel="prefetch" href="/assets/js/87.94d33a73.js"><link rel="prefetch" href="/assets/js/88.e652193a.js"><link rel="prefetch" href="/assets/js/89.85faf96c.js"><link rel="prefetch" href="/assets/js/90.01d8d63c.js"><link rel="prefetch" href="/assets/js/91.e26c2ed5.js"><link rel="prefetch" href="/assets/js/92.30a511f4.js"><link rel="prefetch" href="/assets/js/93.c21eb434.js"><link rel="prefetch" href="/assets/js/94.f7611eb6.js"><link rel="prefetch" href="/assets/js/95.d443ab00.js"><link rel="prefetch" href="/assets/js/96.58237798.js"><link rel="prefetch" href="/assets/js/97.72f7f921.js"><link rel="prefetch" href="/assets/js/98.a6e4129e.js"><link rel="prefetch" href="/assets/js/99.731056a5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5143d2e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4a844ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/link/" class="nav-link">
  å¯¼èˆª
</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘è¿›é˜¶" class="dropdown-title"><span class="title">å¼€å‘è¿›é˜¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘è¿›é˜¶" class="mobile-dropdown-title"><span class="title">å¼€å‘è¿›é˜¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          å·¥ç¨‹åŒ–
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/engineering/" class="nav-link">
  å·¥ç¨‹åŒ–
</a></li></ul></li><li class="dropdown-item"><h4>
          éƒ¨ç½²
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/" class="nav-link">
  éƒ¨ç½²
</a></li></ul></li><li class="dropdown-item"><h4>
          ç®—æ³•
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯å¼€å‘" class="dropdown-title"><span class="title">å‰ç«¯å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯å¼€å‘" class="mobile-dropdown-title"><span class="title">å‰ç«¯å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          H5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          æ¡†æ¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          éšç¬”
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/qa/" class="nav-link">
  QA
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘æŠ€èƒ½" class="dropdown-title"><span class="title">å¼€å‘æŠ€èƒ½</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘æŠ€èƒ½" class="mobile-dropdown-title"><span class="title">å¼€å‘æŠ€èƒ½</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ•°æ®åº“
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/" class="nav-link">
  æ•°æ®åº“
</a></li></ul></li><li class="dropdown-item"><h4>
          åç«¯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/" class="nav-link">
  åç«¯
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é“¾æ¥" class="dropdown-title"><span class="title">é“¾æ¥</span> <span class="arrow down"></span></button> <button type="button" aria-label="é“¾æ¥" class="mobile-dropdown-title"><span class="title">é“¾æ¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://copy.aduang.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å‰ç«¯å½’çº³
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/chnduang/cv-collect-blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/link/" class="nav-link">
  å¯¼èˆª
</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="/mdn/" class="nav-link">
  MDN
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘è¿›é˜¶" class="dropdown-title"><span class="title">å¼€å‘è¿›é˜¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘è¿›é˜¶" class="mobile-dropdown-title"><span class="title">å¼€å‘è¿›é˜¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          å·¥ç¨‹åŒ–
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/engineering/" class="nav-link">
  å·¥ç¨‹åŒ–
</a></li></ul></li><li class="dropdown-item"><h4>
          éƒ¨ç½²
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/" class="nav-link">
  éƒ¨ç½²
</a></li></ul></li><li class="dropdown-item"><h4>
          ç®—æ³•
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯å¼€å‘" class="dropdown-title"><span class="title">å‰ç«¯å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯å¼€å‘" class="mobile-dropdown-title"><span class="title">å‰ç«¯å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          H5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/" class="nav-link">
  CSS
</a></li></ul></li><li class="dropdown-item"><h4>
          æ¡†æ¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          éšç¬”
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/qa/" class="nav-link">
  QA
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘æŠ€èƒ½" class="dropdown-title"><span class="title">å¼€å‘æŠ€èƒ½</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘æŠ€èƒ½" class="mobile-dropdown-title"><span class="title">å¼€å‘æŠ€èƒ½</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          æ•°æ®åº“
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/" class="nav-link">
  æ•°æ®åº“
</a></li></ul></li><li class="dropdown-item"><h4>
          åç«¯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/" class="nav-link">
  åç«¯
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é“¾æ¥" class="dropdown-title"><span class="title">é“¾æ¥</span> <span class="arrow down"></span></button> <button type="button" aria-label="é“¾æ¥" class="mobile-dropdown-title"><span class="title">é“¾æ¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://copy.aduang.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å‰ç«¯å½’çº³
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/chnduang/cv-collect-blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react/" aria-current="page" class="sidebar-link">ç›®å½•</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/1-åŸºç¡€" class="sidebar-heading clickable"><span>åŸºç¡€</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/2-class" class="sidebar-heading clickable"><span>class</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/3-hooks" class="sidebar-heading clickable router-link-active open"><span>hooks</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/3-hooks/" aria-current="page" class="sidebar-link">ç›®å½•</a></li><li><a href="/react/3-hooks/hooksä¸Facedæ¨¡å¼.html" class="sidebar-link">React hooksä¸Facedæ¨¡å¼æ‰æ˜¯æœ€ä½³å®è·µ?</a></li><li><a href="/react/3-hooks/memoå’ŒuseMemoçš„ç”¨æ³•ä¸åŒºåˆ«.html" class="sidebar-link">React.memo() å’Œ useMemo() çš„ç”¨æ³•ä¸åŒºåˆ«</a></li><li><a href="/react/3-hooks/react-hookså¤§ä¸²è®².html" class="active sidebar-link">react-hooks å¤§ä¸²è®²</a></li><li><a href="/react/3-hooks/ä¸è¦å†æ»¥ç”¨useMemoäº†.html" class="sidebar-link">ä¸è¦å†æ»¥ç”¨useMemoäº†ï¼ä½ åº”è¯¥é‡æ–°æ€è€ƒHooks memoization</a></li><li><a href="/react/3-hooks/ä»å‡½æ•°å¼ç»„ä»¶çœ‹Hooksè®¾è®¡.html" class="sidebar-link">ä»å‡½æ•°å¼ç»„ä»¶çœ‹ Hooks è®¾è®¡</a></li><li><a href="/react/3-hooks/ç†è§£useReducerçš„ä¼˜åŠ¿å’Œé«˜çº§ç”¨æ³•.html" class="sidebar-link">ã€Reactçš„ä½œå¼Šæ¨¡å¼ã€‘ç†è§£useReducerçš„ä¼˜åŠ¿å’Œé«˜çº§ç”¨æ³•</a></li><li><a href="/react/3-hooks/è¯´è¯´å¯¹React-Hooksçš„ç†è§£.html" class="sidebar-link">è¯´è¯´å¯¹React Hooksçš„ç†è§£ï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/4-æ€§èƒ½ä¼˜åŒ–" class="sidebar-heading clickable"><span>æ€§èƒ½ä¼˜åŒ–</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/5-ssr" class="sidebar-heading clickable"><span>ssr</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react/6-æºç è§£æ" class="sidebar-heading clickable"><span>æºç è§£æ</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="react-hooks-å¤§ä¸²è®²"><a href="#react-hooks-å¤§ä¸²è®²" class="header-anchor">#</a> react-hooks å¤§ä¸²è®²</h2> <h1 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="header-anchor">#</a> ä¸€ å‰è¨€</h1> <p>ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ï¼Œåˆ†åˆ«ä»‹ç»äº†<code>react-hooks</code>å¦‚ä½•ä½¿ç”¨ï¼Œä»¥åŠè‡ªå®šä¹‰<code>hooks</code>è®¾è®¡æ¨¡å¼åŠå…¶å®æˆ˜ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ä»<code>react-hooks</code>èµ·æºï¼ŒåŸç†ï¼Œæºç è§’åº¦ï¼Œå¼€å§‹å‰–æ<code>react-hooks</code>è¿è¡Œæœºåˆ¶å’Œå†…éƒ¨åŸç†ï¼Œç›¸ä¿¡è¿™ç¯‡æ–‡ç« è¿‡åï¼Œå¯¹äºé¢è¯•çš„æ—¶å€™é‚£äº›<code>hooks</code>é—®é¢˜ï¼Œä¹Ÿå°±è¿åˆƒè€Œè§£äº†ã€‚å®é™…<code>react-hooks</code>ä¹Ÿå¹¶æ²¡æœ‰é‚£ä¹ˆéš¾ä»¥ç†è§£ï¼Œå¬èµ·æ¥å¾ˆ<code>cool</code>ï¼Œå®é™…å°±æ˜¯å‡½æ•°ç»„ä»¶<strong>è§£å†³æ²¡æœ‰<code>state</code>ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œé€»è¾‘ä¸èƒ½å¤ç”¨</strong>çš„ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆã€‚</p> <blockquote><p>Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</p></blockquote> <p>è€è§„çŸ©,ğŸ¤”ï¸ğŸ¤”ï¸ğŸ¤”ï¸æˆ‘ä»¬å¸¦ç€ç–‘é—®å¼€å§‹ä»Šå¤©çš„æ¢è®¨(<strong>èƒ½å›ç­”ä¸Šå‡ ä¸ªï¼Œè‡ªå·±å¯ä»¥å°è¯•ä¸€ä¸‹ï¼ŒæŒæ¡ç¨‹åº¦</strong>)ï¼š</p> <ul><li>1 åœ¨æ— çŠ¶æ€ç»„ä»¶æ¯ä¸€æ¬¡å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>react</code>ç”¨ä»€ä¹ˆæ–¹å¼è®°å½•äº†<code>hooks</code>çš„çŠ¶æ€ï¼Ÿ</li> <li>2 å¤šä¸ª<code>react-hooks</code>ç”¨ä»€ä¹ˆæ¥è®°å½•æ¯ä¸€ä¸ª<code>hooks</code>çš„é¡ºåºçš„ ï¼Ÿæ¢ä¸ªé—®æ³•ï¼ä¸ºä»€ä¹ˆä¸èƒ½æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>? <code>hooks</code>å£°æ˜ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶çš„æœ€é¡¶éƒ¨ï¼Ÿ</li> <li>3 <code>function</code>å‡½æ•°ç»„ä»¶ä¸­çš„<code>useState</code>ï¼Œå’Œ <code>class</code>ç±»ç»„ä»¶ <code>setState</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li> <li>4 <code>react</code> æ˜¯æ€ä¹ˆæ•è·åˆ°<code>hooks</code>çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ˜¯åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨çš„ï¼Ÿ</li> <li>5 <code>useEffect</code>,<code>useMemo</code> ä¸­ï¼Œä¸ºä»€ä¹ˆ<code>useRef</code>ä¸éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå°±èƒ½è®¿é—®åˆ°æœ€æ–°çš„æ”¹å˜å€¼ï¼Ÿ</li> <li>6 <code>useMemo</code>æ˜¯æ€ä¹ˆå¯¹å€¼åšç¼“å­˜çš„ï¼Ÿå¦‚ä½•åº”ç”¨å®ƒä¼˜åŒ–æ€§èƒ½ï¼Ÿ</li> <li>7 ä¸ºä»€ä¹ˆä¸¤æ¬¡ä¼ å…¥<code>useState</code>çš„å€¼ç›¸åŒï¼Œå‡½æ•°ç»„ä»¶ä¸æ›´æ–°?</li> <li>...</li></ul> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9bIKZo5jRmpYBNktnojCSRQwIsGTkrxp8aCIic4o9BjcqQiaasfQ1JoCQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>å¦‚æœä½ è®¤çœŸè¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œè¿™äº›é—®é¢˜å…¨ä¼šè¿åˆƒè€Œè§£ã€‚</p> <h2 id="functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«"><a href="#functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«" class="header-anchor">#</a> functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«</h2> <p>åœ¨è§£é‡Š<code>react-hooks</code>åŸç†çš„ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åŠ æ·±ç†è§£ä¸€ä¸‹ï¼Œ <strong>å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆçœ‹ ä¸¤ä¸ªä»£ç ç‰‡æ®µã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>any<span class="token punctuation">,</span>any<span class="token operator">&gt;</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">number</span><span class="token operator">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">handerClick</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
               console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handerClick <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ‰“å°ç»“æœï¼Ÿ</p> <p>å†æ¥çœ‹çœ‹å‡½æ•°ç»„ä»¶ä¸­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num <span class="token punctuation">,</span>setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handerClick</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">setNumber</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> handerClick <span class="token punctuation">}</span> <span class="token operator">&gt;</span><span class="token punctuation">{</span> num <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ‰“å°ç»“æœï¼Ÿ</p> <p>------------å…¬å¸ƒç­”æ¡ˆ-------------</p> <p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ğŸŒ°æ‰“å°ç»“æœï¼š1 2 3 4 5</p> <p>åœ¨ç¬¬äºŒä¸ªä¾‹å­ğŸŒ°æ‰“å°ç»“æœï¼š0 0 0 0 0</p> <p>è¿™ä¸ªé—®é¢˜å®é™…å¾ˆè’™äººï¼Œæˆ‘ä»¬æ¥ä¸€èµ·åˆ†æä¸€ä¸‹,ç¬¬ä¸€ä¸ªç±»ç»„ä»¶ä¸­ï¼Œç”±äºæ‰§è¡Œä¸Š<code>setState</code>æ²¡æœ‰åœ¨<code>react</code>æ­£å¸¸çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯<code>setTimeout</code>ä¸­æ‰§è¡Œçš„ï¼Œ<strong>æ‰¹é‡æ›´æ–°</strong>æ¡ä»¶è¢«ç ´åã€‚åŸç†è¿™é‡Œæˆ‘å°±ä¸è®²äº†,æ‰€ä»¥å¯ä»¥ç›´æ¥è·å–åˆ°å˜åŒ–åçš„<code>state</code>ã€‚</p> <p>ä½†æ˜¯åœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­ï¼Œä¼¼ä¹æ²¡æœ‰ç”Ÿæ•ˆã€‚åŸå› å¾ˆç®€å•ï¼Œåœ¨<code>class</code>çŠ¶æ€ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹åŒ–çš„<code>class</code>ï¼Œå»ç»´æŠ¤ç»„ä»¶ä¸­çš„å„ç§çŠ¶æ€ï¼›ä½†æ˜¯åœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªçŠ¶æ€å»ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œæ¯ä¸€æ¬¡å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œï¼Œæ‰€æœ‰å˜é‡ï¼Œå¸¸é‡éƒ½é‡æ–°å£°æ˜ï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œå†è¢«åƒåœ¾æœºåˆ¶å›æ”¶ã€‚æ‰€ä»¥å¦‚ä¸Šï¼Œæ— è®º<code>setTimeout</code>æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œéƒ½æ˜¯åœ¨å½“å‰å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œ,æ­¤æ—¶<code>num = 0</code>ä¸ä¼šå˜ï¼Œä¹‹å<code>setNumber</code>æ‰§è¡Œï¼Œå‡½æ•°ç»„ä»¶é‡æ–°æ‰§è¡Œä¹‹åï¼Œ<code>num</code>æ‰å˜åŒ–ã€‚</p> <p>æ‰€ä»¥ï¼Œ å¯¹äº<code>class</code>ç»„ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå®ä¾‹ä¸­ä¿å­˜äº†ç»„ä»¶çš„<code>state</code>ç­‰çŠ¶æ€ã€‚å¯¹äºæ¯ä¸€æ¬¡æ›´æ–°åªéœ€è¦è°ƒç”¨<code>render</code>æ–¹æ³•å°±å¯ä»¥ã€‚ä½†æ˜¯åœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡æ–°çš„å‡½æ•°æ‰§è¡Œ,ä¸ºäº†ä¿å­˜ä¸€äº›çŠ¶æ€,æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨é’©å­,<code>react-hooks</code>åº”è¿è€Œç”Ÿï¼Œå»å¸®åŠ©è®°å½•ç»„ä»¶çš„çŠ¶æ€ï¼Œå¤„ç†ä¸€äº›é¢å¤–çš„å‰¯ä½œç”¨ã€‚</p> <h1 id="ä¸€-åˆè¯†-æ­å¼€hooksçš„é¢çº±"><a href="#ä¸€-åˆè¯†-æ­å¼€hooksçš„é¢çº±" class="header-anchor">#</a> ä¸€ åˆè¯†ï¼šæ­å¼€hooksçš„é¢çº±</h1> <h2 id="_1-å½“æˆ‘ä»¬å¼•å…¥hooksæ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#_1-å½“æˆ‘ä»¬å¼•å…¥hooksæ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ" class="header-anchor">#</a> 1 å½“æˆ‘ä»¬å¼•å…¥hooksæ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2> <p>æˆ‘ä»¬ä»å¼•å…¥ <code>hooks</code>å¼€å§‹ï¼Œä»¥<code>useState</code>ä¸ºä¾‹å­ï¼Œå½“æˆ‘ä»¬ä»é¡¹ç›®ä¸­è¿™ä¹ˆå†™ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>import { useState } from 'react'
</code></pre></div><p>äºæ˜¯ä¹æˆ‘ä»¬å»æ‰¾<code>useState</code>,çœ‹çœ‹å®ƒåˆ°åº•æ˜¯å“ªè·¯ç¥ä»™ï¼Ÿ</p> <div class="language- extra-class"><pre class="language-text"><code>react/src/ReactHooks.js
</code></pre></div><p><strong>useState</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatcher <span class="token operator">=</span> <span class="token function">resolveDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> dispatcher<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>useState()</code> çš„æ‰§è¡Œç­‰äº <code>dispatcher.useState(initialState)</code> è¿™é‡Œé¢å¼•å…¥äº†ä¸€ä¸ª<code>dispatcher</code>ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>resolveDispatcher</code>åšäº†äº›ä»€ä¹ˆï¼Ÿ</p> <p><strong>resolveDispatcher</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">resolveDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatcher <span class="token operator">=</span> ReactCurrentDispatcher<span class="token punctuation">.</span>current
  <span class="token keyword">return</span> dispatcher
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ReactCurrentDispatcher</strong></p> <div class="language- extra-class"><pre class="language-text"><code>react/src/ReactCurrentDispatcher.js
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ReactCurrentDispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">current</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ‘ä»¬çœ‹åˆ°<code>ReactCurrentDispatcher.current</code>åˆå§‹åŒ–çš„æ—¶å€™ä¸º<code>null</code>ï¼Œç„¶åå°±æ²¡ä»»ä½•ä¸‹æ–‡äº†ã€‚æˆ‘ä»¬æš‚ä¸”åªèƒ½æŠŠ**<code>ReactCurrentDispatcher</code>**è®°ä¸‹æ¥ã€‚çœ‹çœ‹<code>ReactCurrentDispatcher</code>ä»€ä¹ˆæ—¶å€™ç”¨åˆ°çš„ ï¼Ÿ</p> <h2 id="_2-å¼€å·¥é€ ç‰©-ä»æ— çŠ¶æ€ç»„ä»¶çš„å‡½æ•°æ‰§è¡Œè¯´èµ·"><a href="#_2-å¼€å·¥é€ ç‰©-ä»æ— çŠ¶æ€ç»„ä»¶çš„å‡½æ•°æ‰§è¡Œè¯´èµ·" class="header-anchor">#</a> 2 å¼€å·¥é€ ç‰©ï¼Œä»æ— çŠ¶æ€ç»„ä»¶çš„å‡½æ•°æ‰§è¡Œè¯´èµ·</h2> <p>æƒ³è¦å½»åº•å¼„æ˜ç™½<code>hooks</code>ï¼Œå°±è¦ä»å…¶æ ¹æºå¼€å§‹ï¼Œä¸Šè¿°æˆ‘ä»¬åœ¨å¼•å…¥<code>hooks</code>çš„æ—¶å€™ï¼Œæœ€åä»¥ä¸€ä¸ª<code>ReactCurrentDispatcher</code>è‰è‰æ”¶å°¾ï¼Œçº¿ç´¢å…¨éƒ¨æ–­äº†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬åªèƒ½ä»å‡½æ•°ç»„ä»¶æ‰§è¡Œå¼€å§‹ã€‚</p> <h3 id="renderwithhooks-æ‰§è¡Œå‡½æ•°"><a href="#renderwithhooks-æ‰§è¡Œå‡½æ•°" class="header-anchor">#</a> renderWithHooks æ‰§è¡Œå‡½æ•°</h3> <p>å¯¹äº<code>function</code>ç»„ä»¶æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„å‘¢ï¼Ÿ</p> <div class="language- extra-class"><pre class="language-text"><code>react-reconciler/src/ReactFiberBeginWork.js
</code></pre></div><p><code>function</code>ç»„ä»¶åˆå§‹åŒ–ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>                <span class="token comment">// current Fiber</span>
    workInProgress<span class="token punctuation">,</span>      <span class="token comment">// workInProgress Fiber</span>
    Component<span class="token punctuation">,</span>           <span class="token comment">// å‡½æ•°ç»„ä»¶æœ¬èº«</span>
    props<span class="token punctuation">,</span>               <span class="token comment">// props</span>
    context<span class="token punctuation">,</span>             <span class="token comment">// ä¸Šä¸‹æ–‡</span>
    renderExpirationTime<span class="token punctuation">,</span><span class="token comment">// æ¸²æŸ“ ExpirationTime</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¯¹äºåˆå§‹åŒ–æ˜¯æ²¡æœ‰<code>current</code>æ ‘çš„ï¼Œä¹‹åå®Œæˆä¸€æ¬¡ç»„ä»¶æ›´æ–°åï¼Œä¼šæŠŠå½“å‰<code>workInProgress</code>æ ‘èµ‹å€¼ç»™<code>current</code>æ ‘ã€‚</p> <p><code>function</code>ç»„ä»¶æ›´æ–°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
    current<span class="token punctuation">,</span>
    workInProgress<span class="token punctuation">,</span>
    render<span class="token punctuation">,</span>
    nextProps<span class="token punctuation">,</span>
    context<span class="token punctuation">,</span>
    renderExpirationTime<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ‘ä»¬ä»ä¸Šè¾¹å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>renderWithHooks</code>å‡½æ•°ä½œç”¨æ˜¯<strong>è°ƒç”¨<code>function</code>ç»„ä»¶å‡½æ•°</strong>çš„ä¸»è¦å‡½æ•°ã€‚æˆ‘ä»¬é‡ç‚¹çœ‹çœ‹<code>renderWithHooks</code>åšäº†äº›ä»€ä¹ˆï¼Ÿ</p> <p><strong>renderWithHooks</strong> <code>react-reconciler/src/ReactFiberHooks.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
  <span class="token parameter">current<span class="token punctuation">,</span>
  workInProgress<span class="token punctuation">,</span>
  Component<span class="token punctuation">,</span>
  props<span class="token punctuation">,</span>
  secondArg<span class="token punctuation">,</span>
  nextRenderExpirationTime<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  renderExpirationTime <span class="token operator">=</span> nextRenderExpirationTime<span class="token punctuation">;</span>
  currentlyRenderingFiber <span class="token operator">=</span> workInProgress<span class="token punctuation">;</span>

  workInProgress<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  workInProgress<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  workInProgress<span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> NoWork<span class="token punctuation">;</span>

  ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span>
      current <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> current<span class="token punctuation">.</span>memoizedState <span class="token operator">===</span> <span class="token keyword">null</span>
        <span class="token operator">?</span> HooksDispatcherOnMount
        <span class="token operator">:</span> HooksDispatcherOnUpdate<span class="token punctuation">;</span>

  <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">Component</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> secondArg<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
       <span class="token comment">// ....è¿™é‡Œçš„é€»è¾‘æˆ‘ä»¬å…ˆæ”¾ä¸€æ”¾</span>
  <span class="token punctuation">}</span>

  ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> ContextOnlyDispatcher<span class="token punctuation">;</span>

  renderExpirationTime <span class="token operator">=</span> NoWork<span class="token punctuation">;</span>
  currentlyRenderingFiber <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  currentHook <span class="token operator">=</span> <span class="token keyword">null</span>
  workInProgressHook <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  didScheduleRenderPhaseUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>æ‰€æœ‰çš„å‡½æ•°ç»„ä»¶æ‰§è¡Œï¼Œéƒ½æ˜¯åœ¨è¿™é‡Œæ–¹æ³•ä¸­</strong>,é¦–å…ˆæˆ‘ä»¬åº”è¯¥æ˜ç™½å‡ ä¸ªæ„Ÿå¿µï¼Œè¿™å¯¹äºåç»­æˆ‘ä»¬ç†è§£<code>useState</code>æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p> <p><code>current fiberæ ‘</code>: å½“å®Œæˆä¸€æ¬¡æ¸²æŸ“ä¹‹åï¼Œä¼šäº§ç”Ÿä¸€ä¸ª<code>current</code>æ ‘,<code>current</code>ä¼šåœ¨<code>commit</code>é˜¶æ®µæ›¿æ¢æˆçœŸå®çš„<code>Dom</code>æ ‘ã€‚</p> <p><code>workInProgress fiberæ ‘</code>: å³å°†è°ƒå’Œæ¸²æŸ“çš„ <code>fiber</code> æ ‘ã€‚å†ä¸€æ¬¡æ–°çš„ç»„ä»¶æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¼šä»<code>current</code>å¤åˆ¶ä¸€ä»½ä½œä¸º<code>workInProgress</code>,æ›´æ–°å®Œæ¯•åï¼Œå°†å½“å‰çš„<code>workInProgress</code>æ ‘èµ‹å€¼ç»™<code>current</code>æ ‘ã€‚</p> <p><code>workInProgress.memoizedState</code>: åœ¨<code>class</code>ç»„ä»¶ä¸­ï¼Œ<code>memoizedState</code>å­˜æ”¾<code>state</code>ä¿¡æ¯ï¼Œåœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œ<strong>è¿™é‡Œå¯ä»¥æå‰é€æ¼ä¸€ä¸‹ï¼Œ<code>memoizedState</code>åœ¨ä¸€æ¬¡è°ƒå’Œæ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾<code>hooks</code>ä¿¡æ¯ã€‚</strong></p> <p><code>workInProgress.expirationTime</code>: <code>react</code>ç”¨ä¸åŒçš„<code>expirationTime</code>,æ¥ç¡®å®šæ›´æ–°çš„ä¼˜å…ˆçº§ã€‚</p> <p><code>currentHook</code> : å¯ä»¥ç†è§£ <code>current</code>æ ‘ä¸Šçš„æŒ‡å‘çš„å½“å‰è°ƒåº¦çš„ <code>hooks</code>èŠ‚ç‚¹ã€‚</p> <p><code>workInProgressHook</code> : å¯ä»¥ç†è§£ <code>workInProgress</code>æ ‘ä¸ŠæŒ‡å‘çš„å½“å‰è°ƒåº¦çš„ <code>hooks</code>èŠ‚ç‚¹ã€‚</p> <p><strong><code>renderWithHooks</code>å‡½æ•°ä¸»è¦ä½œç”¨:</strong></p> <p>é¦–å…ˆå…ˆç½®ç©ºå³å°†è°ƒå’Œæ¸²æŸ“çš„<code>workInProgress</code>æ ‘çš„<code>memoizedState</code>å’Œ<code>updateQueue</code>ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œå› ä¸ºåœ¨æ¥ä¸‹æ¥çš„å‡½æ•°ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦æŠŠæ–°çš„<code>hooks</code>ä¿¡æ¯æŒ‚è½½åˆ°è¿™ä¸¤ä¸ªå±æ€§ä¸Šï¼Œç„¶ååœ¨ç»„ä»¶<code>commit</code>é˜¶æ®µï¼Œå°†<code>workInProgress</code>æ ‘æ›¿æ¢æˆ<code>current</code>æ ‘ï¼Œæ›¿æ¢çœŸå®çš„<code>DOM</code>å…ƒç´ èŠ‚ç‚¹ã€‚å¹¶åœ¨<code>current</code>æ ‘ä¿å­˜<code>hooks</code>ä¿¡æ¯ã€‚</p> <p>ç„¶åæ ¹æ®å½“å‰å‡½æ•°ç»„ä»¶æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œèµ‹äºˆ<code>ReactCurrentDispatcher.current</code>ä¸åŒçš„<code>hooks</code>,ç»ˆäºå’Œä¸Šé¢è®²åˆ°çš„<code>ReactCurrentDispatcher</code>è”ç³»åˆ°ä¸€èµ·ã€‚å¯¹äºç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œé‚£ä¹ˆç”¨çš„æ˜¯<code>HooksDispatcherOnMount</code> hookså¯¹è±¡ã€‚å¯¹äºæ¸²æŸ“åï¼Œéœ€è¦æ›´æ–°çš„å‡½æ•°ç»„ä»¶ï¼Œåˆ™æ˜¯<code>HooksDispatcherOnUpdate</code>å¯¹è±¡ï¼Œé‚£ä¹ˆä¸¤ä¸ªä¸åŒå°±æ˜¯é€šè¿‡<code>current</code>æ ‘ä¸Šæ˜¯å¦<code>memoizedState</code>ï¼ˆhookä¿¡æ¯ï¼‰æ¥åˆ¤æ–­çš„ã€‚å¦‚æœ<code>current</code>ä¸å­˜åœ¨ï¼Œè¯æ˜æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“å‡½æ•°ç»„ä»¶ã€‚</p> <p>æ¥ä¸‹æ¥ï¼Œ<strong>è°ƒç”¨<code>Component(props, secondArg);</code>æ‰§è¡Œæˆ‘ä»¬çš„å‡½æ•°ç»„ä»¶ï¼Œæˆ‘ä»¬çš„å‡½æ•°ç»„ä»¶åœ¨è¿™é‡ŒçœŸæ­£çš„è¢«æ‰§è¡Œäº†ï¼Œç„¶åï¼Œæˆ‘ä»¬å†™çš„<code>hooks</code>è¢«ä¾æ¬¡æ‰§è¡Œï¼ŒæŠŠ<code>hooks</code>ä¿¡æ¯ä¾æ¬¡ä¿å­˜åˆ°<code>workInProgress</code>æ ‘ä¸Šã€‚</strong> è‡³äºå®ƒæ˜¯æ€ä¹ˆä¿å­˜çš„ï¼Œæˆ‘ä»¬é©¬ä¸Šä¼šè®²åˆ°ã€‚</p> <p>æ¥ä¸‹æ¥ï¼Œä¹Ÿå¾ˆé‡è¦ï¼Œå°†<code>ContextOnlyDispatcher</code>èµ‹å€¼ç»™<code>ReactCurrentDispatcher.current</code>ï¼Œç”±äº<code>js</code>æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡æœ‰åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œè°ƒç”¨çš„<code>hooks</code>ï¼Œéƒ½æ˜¯<code>ContextOnlyDispatcher</code>å¯¹è±¡ä¸Š<code>hooks</code>,æˆ‘ä»¬çœ‹çœ‹<code>ContextOnlyDispatcher</code>hooksï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> ContextOnlyDispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">useState</span><span class="token operator">:</span>throwInvalidHookError
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">throwInvalidHookError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">invariant</span><span class="token punctuation">(</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">'Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for'</span> <span class="token operator">+</span>
      <span class="token string">' one of the following reasons:\n'</span> <span class="token operator">+</span>
      <span class="token string">'1. You might have mismatching versions of React and the renderer (such as React DOM)\n'</span> <span class="token operator">+</span>
      <span class="token string">'2. You might be breaking the Rules of Hooks\n'</span> <span class="token operator">+</span>
      <span class="token string">'3. You might have more than one copy of React in the same app\n'</span> <span class="token operator">+</span>
      <span class="token string">'See https://fb.me/react-invalid-hook-call for tips about how to debug and fix this problem.'</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åŸæ¥å¦‚æ­¤ï¼Œ<code>react-hooks</code>å°±æ˜¯é€šè¿‡è¿™ç§å‡½æ•°ç»„ä»¶æ‰§è¡Œèµ‹å€¼ä¸åŒçš„<code>hooks</code>å¯¹è±¡æ–¹å¼ï¼Œåˆ¤æ–­åœ¨<code>hooks</code>æ‰§è¡Œæ˜¯å¦åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨ï¼Œæ•è·å¹¶æŠ›å‡ºå¼‚å¸¸çš„ã€‚</p> <p>æœ€åï¼Œé‡æ–°ç½®ç©ºä¸€äº›å˜é‡æ¯”å¦‚<code>currentHook</code>ï¼Œ<code>currentlyRenderingFiber</code>,<code>workInProgressHook</code>ç­‰ã€‚</p> <h2 id="_3-ä¸åŒçš„hookså¯¹è±¡"><a href="#_3-ä¸åŒçš„hookså¯¹è±¡" class="header-anchor">#</a> 3 ä¸åŒçš„<code>hooks</code>å¯¹è±¡</h2> <p>ä¸Šè¿°è®²åˆ°åœ¨å‡½æ•°ç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶å’Œæ›´æ–°ç»„ä»¶åˆ†åˆ«è°ƒç”¨ä¸åŒçš„<code>hooks</code>å¯¹è±¡ï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹<code>HooksDispatcherOnMount</code> å’Œ <code>HooksDispatcherOnUpdate</code>ã€‚</p> <p><strong>ç¬¬ä¸€æ¬¡æ¸²æŸ“(æˆ‘è¿™é‡Œåªå±•ç¤ºäº†å¸¸ç”¨çš„<code>hooks</code>)ï¼š</strong></p> <div class="language- extra-class"><pre class="language-text"><code>
const HooksDispatcherOnMount = {
  useCallback: mountCallback,
  useEffect: mountEffect,
  useLayoutEffect: mountLayoutEffect,
  useMemo: mountMemo,
  useReducer: mountReducer,
  useRef: mountRef,
  useState: mountState,
};
</code></pre></div><p><strong>æ›´æ–°ç»„ä»¶ï¼š</strong></p> <div class="language- extra-class"><pre class="language-text"><code>const HooksDispatcherOnUpdate = {
  useCallback: updateCallback,
  useEffect: updateEffect,
  useLayoutEffect: updateLayoutEffect,
  useMemo: updateMemo,
  useReducer: updateReducer,
  useRef: updateRef,
  useState: updateState
};
</code></pre></div><p>çœ‹æ¥å¯¹äºç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œå’Œæ›´æ–°ç»„ä»¶ï¼Œ<code>react-hooks</code>é‡‡ç”¨äº†ä¸¤å¥—<code>Api</code>ï¼Œæœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†å’Œç¬¬ä¸‰éƒ¨åˆ†ï¼Œå°†é‡ç‚¹ä¸¤è€…çš„è”ç³»ã€‚</p> <p>æˆ‘ä»¬ç”¨æµç¨‹å›¾æ¥æè¿°æ•´ä¸ªè¿‡ç¨‹ï¼š</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9LcnSriatHd9Jx7JTQIEuZSPkTH5DC14Qctm8htcs1hFtb9gpY48JQXQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h2 id="ä¸‰-hooksåˆå§‹åŒ–-æˆ‘ä»¬å†™çš„hooksä¼šå˜æˆä»€ä¹ˆæ ·å­"><a href="#ä¸‰-hooksåˆå§‹åŒ–-æˆ‘ä»¬å†™çš„hooksä¼šå˜æˆä»€ä¹ˆæ ·å­" class="header-anchor">#</a> ä¸‰ hooksåˆå§‹åŒ–ï¼Œæˆ‘ä»¬å†™çš„hooksä¼šå˜æˆä»€ä¹ˆæ ·å­</h2> <p>æœ¬æ–‡å°†é‡ç‚¹å›´ç»•å››ä¸ªä¸­é‡ç‚¹<code>hooks</code>å±•å¼€ï¼Œåˆ†åˆ«æ˜¯è´Ÿè´£ç»„ä»¶æ›´æ–°çš„<code>useState</code>ï¼Œè´Ÿè´£æ‰§è¡Œå‰¯ä½œç”¨<code>useEffect</code> ,è´Ÿè´£ä¿å­˜æ•°æ®çš„<code>useRef</code>,è´Ÿè´£ç¼“å­˜ä¼˜åŒ–çš„<code>useMemo</code>ï¼Œ è‡³äº<code>useCallback</code>,<code>useReducer</code>,<code>useLayoutEffect</code>åŸç†å’Œé‚£å››ä¸ªé‡ç‚¹<code>hooks</code>æ¯”è¾ƒç›¸è¿‘ï¼Œå°±ä¸ä¸€ä¸€è§£é‡Šäº†ã€‚</p> <p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”ç”¨åˆ°ä¸Šè¿°å››ä¸ªä¸»è¦<code>hooks</code>ï¼š</p> <p><strong>è¯·è®°ä½å¦‚ä¸‹ä»£ç ç‰‡æ®µï¼Œåé¢è®²è§£å°†ä»¥å¦‚ä¸‹ä»£ç æ®µå±•å¼€</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">,</span> useState <span class="token punctuation">,</span> useRef <span class="token punctuation">,</span> useMemo  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span> setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> DivDemo <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello <span class="token punctuation">,</span> i am useMemo <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> curRef  <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>curRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span> curRef <span class="token punctuation">}</span> <span class="token operator">&gt;</span>
        hello<span class="token punctuation">,</span>world <span class="token punctuation">{</span> number <span class="token punctuation">}</span> 
        <span class="token punctuation">{</span> DivDemo <span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>number<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·ç ”ç©¶ä¸€ä¸‹æˆ‘ä»¬ä¸Šè¿°å†™çš„å››ä¸ª<code>hooks</code>æœ€ç»ˆä¼šå˜æˆä»€ä¹ˆï¼Ÿ</p> <h3 id="_1-mountworkinprogresshook"><a href="#_1-mountworkinprogresshook" class="header-anchor">#</a> 1 mountWorkInProgressHook</h3> <p>åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™,æ¯ä¸€æ¬¡<code>hooks</code>æ‰§è¡Œï¼Œå¦‚<code>useState()</code>,<code>useRef()</code>,éƒ½ä¼šè°ƒç”¨<code>mountWorkInProgressHook</code>,<code>mountWorkInProgressHook</code>åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>react-reconciler/src/ReactFiberHooks.js -&gt; mountWorkInProgressHook
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">hook</span><span class="token operator">:</span> Hook <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// useStateä¸­ ä¿å­˜ stateä¿¡æ¯ ï½œ useEffect ä¸­ ä¿å­˜ç€ effect å¯¹è±¡ ï½œ useMemo ä¸­ ä¿å­˜çš„æ˜¯ç¼“å­˜çš„å€¼å’Œdeps ï½œ useRefä¸­ä¿å­˜çš„æ˜¯ref å¯¹è±¡</span>
    <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">baseQueue</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">queue</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ä¾‹å­ä¸­çš„ç¬¬ä¸€ä¸ª`hooks`-&gt; useState(0) èµ°çš„å°±æ˜¯è¿™æ ·ã€‚</span>
    currentlyRenderingFiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>mountWorkInProgressHook</code>è¿™ä¸ªå‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œé¦–å…ˆæ¯æ¬¡æ‰§è¡Œä¸€ä¸ª<code>hooks</code>å‡½æ•°ï¼Œéƒ½äº§ç”Ÿä¸€ä¸ª<code>hook</code>å¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜äº†å½“å‰<code>hook</code>ä¿¡æ¯,ç„¶åå°†æ¯ä¸ª<code>hooks</code>ä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥ï¼Œå¹¶èµ‹å€¼ç»™<code>workInProgress</code>çš„<code>memoizedState</code>ã€‚ä¹Ÿå°±è¯å®äº†ä¸Šè¿°æ‰€è¯´çš„ï¼Œå‡½æ•°ç»„ä»¶ç”¨<code>memoizedState</code>å­˜æ”¾<code>hooks</code>é“¾è¡¨ã€‚</p> <p>è‡³äº<code>hook</code>å¯¹è±¡ä¸­éƒ½ä¿ç•™äº†å“ªäº›ä¿¡æ¯ï¼Ÿæˆ‘è¿™é‡Œå…ˆåˆ†åˆ«ä»‹ç»ä¸€ä¸‹ :</p> <p><strong>memoizedState</strong>ï¼š <code>useStateä¸­</code> ä¿å­˜ <code>state</code> ä¿¡æ¯ ï½œ <code>useEffect</code> ä¸­ ä¿å­˜ç€ <code>effect</code> å¯¹è±¡ ï½œ <code>useMemo</code> ä¸­ ä¿å­˜çš„æ˜¯ç¼“å­˜çš„å€¼å’Œ <code>deps</code> ï½œ <code>useRef</code> ä¸­ä¿å­˜çš„æ˜¯ <code>ref</code> å¯¹è±¡ã€‚</p> <p><strong>baseState</strong> : <code>usestate</code>å’Œ<code>useReducer</code>ä¸­ ä¿å­˜æœ€æ–°çš„æ›´æ–°é˜Ÿåˆ—ã€‚</p> <p><strong>baseState</strong> ï¼š <code>usestate</code>å’Œ<code>useReducer</code>ä¸­,ä¸€æ¬¡æ›´æ–°ä¸­ ï¼Œäº§ç”Ÿçš„æœ€æ–°<code>state</code>å€¼ã€‚</p> <p><strong>queue</strong> ï¼šä¿å­˜å¾…æ›´æ–°é˜Ÿåˆ— <code>pendingQueue</code> ï¼Œæ›´æ–°å‡½æ•° <code>dispatch</code> ç­‰ä¿¡æ¯ã€‚</p> <p><strong>next</strong>: æŒ‡å‘ä¸‹ä¸€ä¸ª <code>hooks</code>å¯¹è±¡ã€‚</p> <p>é‚£ä¹ˆå½“æˆ‘ä»¬å‡½æ•°ç»„ä»¶æ‰§è¡Œä¹‹åï¼Œå››ä¸ª<code>hooks</code>å’Œ<code>workInProgress</code>å°†æ˜¯å¦‚å›¾çš„å…³ç³»ã€‚</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9qZXHmqqVpEuxe38Ints9shhqIpw0fcjYtWOiaZXP3JIsSnLpEMkzaVw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>çŸ¥é“æ¯ä¸ª<code>hooks</code>å…³ç³»ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥ç†è§£äº†ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>ã€‚</p> <p>æˆ‘ä»¬ç”¨ä¸€å¹…å›¾è¡¨ç¤ºå¦‚æœåœ¨æ¡ä»¶è¯­å¥ä¸­å£°æ˜ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘ç”Ÿã€‚</p> <p>å¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°<code>demo</code>å…¶ä¸­çš„ä¸€ä¸ª <code>useRef</code> æ”¾å…¥æ¡ä»¶è¯­å¥ä¸­ï¼Œ</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">let</span> curRef  <span class="token operator">=</span> <span class="token keyword">null</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>isFisrt<span class="token punctuation">)</span><span class="token punctuation">{</span>
  curRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf90Ka0x0zMCRHYp40eibCoqWPoXicAPZU99OY2F2puicstuvR46RmHYaNGw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p><strong>å› ä¸ºä¸€æ—¦åœ¨æ¡ä»¶è¯­å¥ä¸­å£°æ˜<code>hooks</code>ï¼Œåœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œ<code>hooks</code>é“¾è¡¨ç»“æ„ï¼Œå°†ä¼šè¢«ç ´åï¼Œ<code>current</code>æ ‘çš„<code>memoizedState</code>ç¼“å­˜<code>hooks</code>ä¿¡æ¯ï¼Œå’Œå½“å‰<code>workInProgress</code>ä¸ä¸€è‡´ï¼Œå¦‚æœæ¶‰åŠåˆ°è¯»å–<code>state</code>ç­‰æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</strong></p> <p>ä¸Šè¿°ä»‹ç»äº† <code>hooks</code>é€šè¿‡ä»€ä¹ˆæ¥è¯æ˜å”¯ä¸€æ€§çš„ï¼Œç­”æ¡ˆ ï¼Œé€šè¿‡<code>hooks</code>é“¾è¡¨é¡ºåºã€‚å’Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§å››ä¸ªæ–¹å‘ï¼Œåˆ†åˆ«ä»‹ç»åˆå§‹åŒ–çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p> <h3 id="_2-åˆå§‹åŒ–usestate-mountstate"><a href="#_2-åˆå§‹åŒ–usestate-mountstate" class="header-anchor">#</a> 2 åˆå§‹åŒ–useState -&gt; mountState</h3> <p><strong>mountState</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountState</span><span class="token punctuation">(</span>
  <span class="token parameter">initialState</span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> initialState <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœ useState ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°å¾—åˆ°state</span>
    initialState <span class="token operator">=</span> <span class="token function">initialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">.</span>baseState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>
  <span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// å¸¦æ›´æ–°çš„</span>
    <span class="token literal-property property">dispatch</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// è´Ÿè´£æ›´æ–°å‡½æ•°</span>
    <span class="token literal-property property">lastRenderedReducer</span><span class="token operator">:</span> basicStateReducer<span class="token punctuation">,</span> <span class="token comment">//ç”¨äºå¾—åˆ°æœ€æ–°çš„ state ,</span>
    <span class="token literal-property property">lastRenderedState</span><span class="token operator">:</span> initialState<span class="token punctuation">,</span> <span class="token comment">// æœ€åä¸€æ¬¡å¾—åˆ°çš„ state</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span> <span class="token comment">// è´Ÿè´£æ›´æ–°çš„å‡½æ•°</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>
    currentlyRenderingFiber<span class="token punctuation">,</span>
    queue<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>mountState</code>åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Œé¦–å…ˆä¼šå¾—åˆ°åˆå§‹åŒ–çš„<code>state</code>ï¼Œå°†å®ƒèµ‹å€¼ç»™<code>mountWorkInProgressHook</code>äº§ç”Ÿçš„<code>hook</code>å¯¹è±¡çš„ <code>memoizedState</code>å’Œ<code>baseState</code>å±æ€§ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª<code>queue</code>å¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜äº†è´Ÿè´£æ›´æ–°çš„ä¿¡æ¯ã€‚</p> <p>è¿™é‡Œå…ˆè¯´ä¸€ä¸‹ï¼Œåœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­ï¼Œ<code>useState</code>å’Œ<code>useReducer</code>è§¦å‘å‡½æ•°æ›´æ–°çš„æ–¹æ³•éƒ½æ˜¯<code>dispatchAction</code>,<code>useState</code>ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªç®€åŒ–ç‰ˆçš„<code>useReducer</code>,è‡³äº<code>dispatchAction</code>æ€ä¹ˆæ›´æ–°<code>state</code>ï¼Œæ›´æ–°ç»„ä»¶çš„ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹ç ”ç©¶<code>dispatchAction</code>ã€‚</p> <p>åœ¨ç ”ç©¶ä¹‹å‰ æˆ‘ä»¬<strong>å…ˆè¦å¼„æ˜ç™½<code>dispatchAction</code>æ˜¯ä»€ä¹ˆ?</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> dispatchAction<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
  <span class="token literal-property property">fiber</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  <span class="token literal-property property">queue</span><span class="token operator">:</span> UpdateQueue<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span> setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p><strong><code>dispatchAction</code> å°±æ˜¯ <code>setNumber</code></strong> , <code>dispatchAction</code> ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå·²ç»è¢«<code>bind</code>ç»™æ”¹æˆ<code>currentlyRenderingFiber</code>å’Œ <code>queue</code>,æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°<code>action</code></p> <h4 id="dispatchaction-æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶"><a href="#dispatchaction-æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶" class="header-anchor">#</a> dispatchAction æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶</h4> <p>ä½œä¸ºæ›´æ–°çš„ä¸»è¦å‡½æ•°ï¼Œæˆ‘ä»¬ä¸€ä¸‹æ¥ç ”ç©¶ä¸€ä¸‹ï¼Œæˆ‘æŠŠ <code>dispatchAction</code> ç²¾ç®€ï¼Œç²¾ç®€ï¼Œå†ç²¾ç®€ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dispatchAction</span><span class="token punctuation">(</span><span class="token parameter">fiber<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è®¡ç®— expirationTime è¿‡ç¨‹ç•¥è¿‡ã€‚</span>
  <span class="token comment">/* åˆ›å»ºä¸€ä¸ªupdate */</span>
  <span class="token keyword">const</span> update<span class="token operator">=</span> <span class="token punctuation">{</span>
    expirationTime<span class="token punctuation">,</span>
    suspenseConfig<span class="token punctuation">,</span>
    action<span class="token punctuation">,</span>
    <span class="token literal-property property">eagerReducer</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">eagerState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* æŠŠåˆ›å»ºçš„update */</span>
  <span class="token keyword">const</span> pending <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pending <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// è¯æ˜ç¬¬ä¸€æ¬¡æ›´æ–°</span>
    update<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡æ›´æ–°</span>
    update<span class="token punctuation">.</span>next <span class="token operator">=</span> pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    pending<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> update<span class="token punctuation">;</span>
  <span class="token keyword">const</span> alternate <span class="token operator">=</span> fiber<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
  <span class="token comment">/* åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨æ¸²æŸ“é˜¶æ®µ */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> fiber <span class="token operator">===</span> currentlyRenderingFiber <span class="token operator">||</span> <span class="token punctuation">(</span>alternate <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> alternate <span class="token operator">===</span> currentlyRenderingFiber<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    didScheduleRenderPhaseUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    update<span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> renderExpirationTime<span class="token punctuation">;</span>
    currentlyRenderingFiber<span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> renderExpirationTime<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">/* å½“å‰å‡½æ•°ç»„ä»¶å¯¹åº”fiberæ²¡æœ‰å¤„äºè°ƒå’Œæ¸²æŸ“é˜¶æ®µ ï¼Œé‚£ä¹ˆè·å–æœ€æ–°state , æ‰§è¡Œæ›´æ–° */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fiber<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> NoWork <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>alternate <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> alternate<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> NoWork<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> lastRenderedReducer <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastRenderedReducer<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>lastRenderedReducer <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> prevDispatcher<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> currentState <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastRenderedState<span class="token punctuation">;</span> <span class="token comment">/* ä¸Šä¸€æ¬¡çš„state */</span>
          <span class="token keyword">const</span> eagerState <span class="token operator">=</span> <span class="token function">lastRenderedReducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/**/</span>
          update<span class="token punctuation">.</span>eagerReducer <span class="token operator">=</span> lastRenderedReducer<span class="token punctuation">;</span>
          update<span class="token punctuation">.</span>eagerState <span class="token operator">=</span> eagerState<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is</span><span class="token punctuation">(</span>eagerState<span class="token punctuation">,</span> currentState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> expirationTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ— è®ºæ˜¯ç±»ç»„ä»¶è°ƒç”¨<code>setState</code>,è¿˜æ˜¯å‡½æ•°ç»„ä»¶çš„<code>dispatchAction</code> ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª <code>update</code>å¯¹è±¡ï¼Œé‡Œé¢è®°å½•äº†æ­¤æ¬¡æ›´æ–°çš„ä¿¡æ¯ï¼Œç„¶åå°†æ­¤<code>update</code>æ”¾å…¥å¾…æ›´æ–°çš„<code>pending</code>é˜Ÿåˆ—ä¸­ï¼Œ<code>dispatchAction</code>ç¬¬äºŒæ­¥å°±æ˜¯åˆ¤æ–­å½“å‰å‡½æ•°ç»„ä»¶çš„<code>fiber</code>å¯¹è±¡æ˜¯å¦å¤„äºæ¸²æŸ“é˜¶æ®µï¼Œå¦‚æœå¤„äºæ¸²æŸ“é˜¶æ®µï¼Œé‚£ä¹ˆä¸éœ€è¦æˆ‘ä»¬åœ¨æ›´æ–°å½“å‰å‡½æ•°ç»„ä»¶ï¼Œåªéœ€è¦æ›´æ–°ä¸€ä¸‹å½“å‰<code>update</code>çš„<code>expirationTime</code>å³å¯ã€‚</p> <p>å¦‚æœå½“å‰<code>fiber</code>æ²¡æœ‰å¤„äºæ›´æ–°é˜¶æ®µã€‚é‚£ä¹ˆé€šè¿‡è°ƒç”¨<code>lastRenderedReducer</code>è·å–æœ€æ–°çš„<code>state</code>,å’Œä¸Šä¸€æ¬¡çš„<code>currentState</code>ï¼Œè¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå°±é€€å‡ºï¼Œè¿™å°±è¯å®äº†ä¸ºä»€ä¹ˆ<code>useState</code>ï¼Œä¸¤æ¬¡å€¼ç›¸ç­‰çš„æ—¶å€™ï¼Œç»„ä»¶ä¸æ¸²æŸ“çš„åŸå› äº†ï¼Œè¿™ä¸ªæœºåˆ¶å’Œ<code>Component</code>æ¨¡å¼ä¸‹çš„<code>setState</code>æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚</p> <p>å¦‚æœä¸¤æ¬¡<code>state</code>ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè°ƒç”¨<code>scheduleUpdateOnFiber</code>è°ƒåº¦æ¸²æŸ“å½“å‰<code>fiber</code>ï¼Œ<code>scheduleUpdateOnFiber</code>æ˜¯<code>react</code>æ¸²æŸ“æ›´æ–°çš„ä¸»è¦å‡½æ•°ã€‚</p> <p>æˆ‘ä»¬æŠŠ<strong>åˆå§‹åŒ–<code>mountState</code>**å’Œ**æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶</strong>è®²æ˜ç™½äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å…¶ä»–çš„<strong>hooks</strong>åˆå§‹åŒ–åšäº†äº›ä»€ä¹ˆæ“ä½œï¼Ÿ</p> <h3 id="_3-åˆå§‹åŒ–useeffect-mounteffect"><a href="#_3-åˆå§‹åŒ–useeffect-mounteffect" class="header-anchor">#</a> 3 åˆå§‹åŒ–useEffect -&gt; mountEffect</h3> <p>ä¸Šè¿°è®²åˆ°äº†æ— çŠ¶æ€ç»„ä»¶ä¸­<code>fiber</code>å¯¹è±¡<code>memoizedState</code>ä¿å­˜å½“å‰çš„<code>hooks</code>å½¢æˆçš„é“¾è¡¨ã€‚é‚£ä¹ˆ<code>updateQueue</code>ä¿å­˜äº†ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥æ¢ç´¢<code>useEffect</code>è¿‡ç¨‹ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>useEffect</code>çš„æ—¶å€™ï¼Œåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ä¼šè°ƒç”¨<code>mountEffect</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Ÿ</p> <h4 id="mounteffect"><a href="#mounteffect" class="header-anchor">#</a> mountEffect</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountEffect</span><span class="token punctuation">(</span>
  <span class="token parameter">create<span class="token punctuation">,</span>
  deps<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token function">pushEffect</span><span class="token punctuation">(</span>
    HookHasEffect <span class="token operator">|</span> hookEffectTag<span class="token punctuation">,</span> 
    create<span class="token punctuation">,</span> <span class="token comment">// useEffect ç¬¬ä¸€æ¬¡å‚æ•°ï¼Œå°±æ˜¯å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    nextDeps<span class="token punctuation">,</span> <span class="token comment">// useEffect ç¬¬äºŒæ¬¡å‚æ•°ï¼Œdeps</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>æ¯ä¸ª<code>hooks</code>åˆå§‹åŒ–éƒ½ä¼šåˆ›å»ºä¸€ä¸ª<code>hook</code>å¯¹è±¡ï¼Œç„¶åå°†hookçš„<code>memoizedState</code>ä¿å­˜å½“å‰<code>effect hook</code>ä¿¡æ¯ã€‚</p> <p><strong>æœ‰ä¸¤ä¸ª<code>memoizedState</code>å¤§å®¶åƒä¸‡åˆ«æ··æ·†äº†ï¼Œæˆ‘è¿™é‡Œå†å‹æƒ…æç¤ºä¸€é</strong></p> <ul><li><code>workInProgress / current</code> æ ‘ä¸Šçš„ <code>memoizedState</code> ä¿å­˜çš„æ˜¯å½“å‰å‡½æ•°ç»„ä»¶æ¯ä¸ª<code>hooks</code>å½¢æˆçš„é“¾è¡¨ã€‚</li> <li>æ¯ä¸ª<code>hooks</code>ä¸Šçš„<code>memoizedState</code> ä¿å­˜äº†å½“å‰<code>hooks</code>ä¿¡æ¯ï¼Œä¸åŒç§ç±»çš„<code>hooks</code>çš„<code>memoizedState</code>å†…å®¹ä¸åŒã€‚ä¸Šè¿°çš„æ–¹æ³•æœ€åæ‰§è¡Œäº†ä¸€ä¸ª<code>pushEffect</code>ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹<code>pushEffect</code>åšäº†äº›ä»€ä¹ˆï¼Ÿ</li></ul> <h4 id="pusheffect-åˆ›å»ºeffectå¯¹è±¡-æŒ‚è½½updatequeue"><a href="#pusheffect-åˆ›å»ºeffectå¯¹è±¡-æŒ‚è½½updatequeue" class="header-anchor">#</a> pushEffect åˆ›å»ºeffectå¯¹è±¡ï¼ŒæŒ‚è½½updateQueue</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">pushEffect</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> create<span class="token punctuation">,</span> destroy<span class="token punctuation">,</span> deps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> effect <span class="token operator">=</span> <span class="token punctuation">{</span>
    tag<span class="token punctuation">,</span>
    create<span class="token punctuation">,</span>
    destroy<span class="token punctuation">,</span>
    deps<span class="token punctuation">,</span>
    <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> componentUpdateQueue <span class="token operator">=</span> currentlyRenderingFiber<span class="token punctuation">.</span>updateQueue
  <span class="token keyword">if</span> <span class="token punctuation">(</span>componentUpdateQueue <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€ä¸ª useEffect</span>
    componentUpdateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token literal-property property">lastEffect</span><span class="token operator">:</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span>
    currentlyRenderingFiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> componentUpdateQueue
    componentUpdateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> effect<span class="token punctuation">.</span>next <span class="token operator">=</span> effect<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// å­˜åœ¨å¤šä¸ªeffect</span>
    <span class="token keyword">const</span> lastEffect <span class="token operator">=</span> componentUpdateQueue<span class="token punctuation">.</span>lastEffect<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastEffect <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      componentUpdateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> effect<span class="token punctuation">.</span>next <span class="token operator">=</span> effect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> firstEffect <span class="token operator">=</span> lastEffect<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
      lastEffect<span class="token punctuation">.</span>next <span class="token operator">=</span> effect<span class="token punctuation">;</span>
      effect<span class="token punctuation">.</span>next <span class="token operator">=</span> firstEffect<span class="token punctuation">;</span>
      componentUpdateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> effect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> effect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸€æ®µå®é™…å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>effect</code> ï¼Œåˆ¤æ–­ç»„ä»¶å¦‚æœç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œé‚£ä¹ˆåˆ›å»º <code>componentUpdateQueue</code> ï¼Œå°±æ˜¯<code>workInProgress</code>çš„<code>updateQueue</code>ã€‚ç„¶åå°†<code>effect</code>æ”¾å…¥<code>updateQueue</code>ä¸­ï¼Œä¸è¿‡è¿™é‡Œé¡ºåºè¦ä¸»è¦ï¼Œè¶Šé åçš„<code>effect</code>ï¼Œè¶Šåœ¨<code>updateQueue</code>å‰è¾¹ã€‚</p> <p>å‡è®¾æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ä¸­è¿™ä¹ˆå†™ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span> props<span class="token punctuation">.</span>a <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>æœ€å<code>workInProgress.updateQueue</code>ä¼šä»¥è¿™æ ·çš„å½¢å¼ä¿å­˜ï¼š</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9jNiaib0msKJErgyicLhJQicqUwicU5gf1MIUPf1ptyeT0AKnFWAzcTQGn3w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h4 id="æ‹“å±•-effectlist"><a href="#æ‹“å±•-effectlist" class="header-anchor">#</a> æ‹“å±•:effectList</h4> <p><code>effect list</code> å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨ <code>effectTag</code> å‰¯ä½œç”¨åˆ—è¡¨å®¹å™¨ã€‚å®ƒæ˜¯ç”± <code>fiber</code> èŠ‚ç‚¹å’ŒæŒ‡é’ˆ <code>nextEffect</code> æ„æˆçš„å•é“¾è¡¨ç»“æ„ï¼Œè¿™å…¶ä¸­è¿˜åŒ…æ‹¬ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ <code>firstEffect</code> ï¼Œå’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹ <code>lastEffect</code>ã€‚ <code>React</code> é‡‡ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼Œåœ¨ <code>render</code> é˜¶æ®µéå† <code>fiber</code> æ ‘æ—¶ï¼ŒæŠŠæ¯ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„ <code>fiber</code> ç­›é€‰å‡ºæ¥ï¼Œæœ€åæ„å»ºç”Ÿæˆä¸€ä¸ªåªå¸¦å‰¯ä½œç”¨çš„ <code>effect list</code> é“¾è¡¨ã€‚åœ¨ <code>commit</code> é˜¶æ®µï¼Œ<code>React</code> æ‹¿åˆ° <code>effect list</code> æ•°æ®åï¼Œé€šè¿‡éå† <code>effect list</code>ï¼Œå¹¶æ ¹æ®æ¯ä¸€ä¸ª <code>effect</code> èŠ‚ç‚¹çš„ <code>effectTag</code> ç±»å‹ï¼Œæ‰§è¡Œæ¯ä¸ª<code>effect</code>ï¼Œä»è€Œå¯¹ç›¸åº”çš„ <code>DOM</code> æ ‘æ‰§è¡Œæ›´æ”¹ã€‚</p> <h3 id="_4-åˆå§‹åŒ–usememo-mountmemo"><a href="#_4-åˆå§‹åŒ–usememo-mountmemo" class="header-anchor">#</a> 4 åˆå§‹åŒ–useMemo -&gt; mountMemo</h3> <p>ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æŠŠ <code>useMemo</code> æƒ³è±¡çš„è¿‡äºå¤æ‚äº†ï¼Œå®é™…ç›¸æ¯”å…¶ä»– <code>useState</code> , <code>useEffect</code>ç­‰ï¼Œå®ƒçš„é€»è¾‘å®é™…ç®€å•çš„å¾ˆã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountMemo</span><span class="token punctuation">(</span><span class="token parameter">nextCreate<span class="token punctuation">,</span>deps</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextValue <span class="token operator">=</span> <span class="token function">nextCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token punctuation">[</span>nextValue<span class="token punctuation">,</span> nextDeps<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> nextValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åˆå§‹åŒ–<code>useMemo</code>ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª<code>hook</code>ï¼Œç„¶åæ‰§è¡Œ<code>useMemo</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°,å¾—åˆ°éœ€è¦ç¼“å­˜çš„å€¼ï¼Œç„¶åå°†å€¼å’Œ<code>deps</code>è®°å½•ä¸‹æ¥ï¼Œèµ‹å€¼ç»™å½“å‰<code>hook</code>çš„<code>memoizedState</code>ã€‚æ•´ä½“ä¸Šå¹¶æ²¡æœ‰å¤æ‚çš„é€»è¾‘ã€‚</p> <h3 id="_5-åˆå§‹åŒ–useref-mountref"><a href="#_5-åˆå§‹åŒ–useref-mountref" class="header-anchor">#</a> 5 åˆå§‹åŒ–useRef -&gt; mountRef</h3> <p>å¯¹äº<code>useRef</code>åˆå§‹åŒ–å¤„ç†ï¼Œä¼¼ä¹æ›´æ˜¯ç®€å•ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mountRef</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">current</span><span class="token operator">:</span> initialValue<span class="token punctuation">}</span><span class="token punctuation">;</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> ref<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>mountRef</code>åˆå§‹åŒ–å¾ˆç®€å•, åˆ›å»ºä¸€ä¸ªrefå¯¹è±¡ï¼Œ å¯¹è±¡çš„<code>current</code> å±æ€§æ¥ä¿å­˜åˆå§‹åŒ–çš„å€¼ï¼Œæœ€åç”¨<code>memoizedState</code>ä¿å­˜<code>ref</code>ï¼Œå®Œæˆæ•´ä¸ªæ“ä½œã€‚</p> <h3 id="_6-mounted-é˜¶æ®µ-hooks-æ€»ç»“"><a href="#_6-mounted-é˜¶æ®µ-hooks-æ€»ç»“" class="header-anchor">#</a> 6 mounted é˜¶æ®µ hooks æ€»ç»“</h3> <p>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹åˆå§‹åŒ–é˜¶æ®µ,<code>react-hooks</code>åšçš„äº‹æƒ…ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸Šä¸‹æ–‡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª<code>react-hooks</code>æ‰§è¡Œï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª<code>hook</code>å¯¹è±¡ï¼Œå¹¶å½¢æˆé“¾è¡¨ç»“æ„ï¼Œç»‘å®šåœ¨<code>workInProgress</code>çš„<code>memoizedState</code>å±æ€§ä¸Šï¼Œç„¶å<code>react-hooks</code>ä¸Šçš„çŠ¶æ€ï¼Œç»‘å®šåœ¨å½“å‰<code>hooks</code>å¯¹è±¡çš„<code>memoizedState</code>å±æ€§ä¸Šã€‚å¯¹äº<code>effect</code>å‰¯ä½œç”¨é’©å­ï¼Œä¼šç»‘å®šåœ¨<code>workInProgress.updateQueue</code>ä¸Šï¼Œç­‰åˆ°<code>commit</code>é˜¶æ®µï¼Œ<code>dom</code>æ ‘æ„å»ºå®Œæˆï¼Œåœ¨æ‰§è¡Œæ¯ä¸ª <code>effect</code> å‰¯ä½œç”¨é’©å­ã€‚</p> <h2 id="å››-hooksæ›´æ–°é˜¶æ®µ"><a href="#å››-hooksæ›´æ–°é˜¶æ®µ" class="header-anchor">#</a> å›› hooksæ›´æ–°é˜¶æ®µ</h2> <p>ä¸Šè¿°ä»‹ç»äº†ç¬¬ä¸€æ¬¡æ¸²æŸ“å‡½æ•°ç»„ä»¶ï¼Œ<code>react-hooks</code>åˆå§‹åŒ–éƒ½åšäº›ä»€ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œ</p> <p>å¯¹äºæ›´æ–°é˜¶æ®µï¼Œè¯´æ˜ä¸Šä¸€æ¬¡ <code>workInProgress</code> æ ‘å·²ç»èµ‹å€¼ç»™äº† <code>current</code> æ ‘ã€‚å­˜æ”¾<code>hooks</code>ä¿¡æ¯çš„<code>memoizedState</code>ï¼Œæ­¤æ—¶å·²ç»å­˜åœ¨<code>current</code>æ ‘ä¸Šï¼Œ<code>react</code>å¯¹äº<code>hooks</code>çš„å¤„ç†é€»è¾‘å’Œ<code>fiber</code>æ ‘é€»è¾‘ç±»ä¼¼ã€‚</p> <p>å¯¹äºä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œå½“å†æ¬¡æ‰§è¡Œ<code>hooks</code>å‡½æ•°çš„æ—¶å€™ï¼Œæ¯”å¦‚ <code>useState(0)</code> ï¼Œé¦–å…ˆè¦ä»<code>current</code>çš„<code>hooks</code>ä¸­æ‰¾åˆ°ä¸å½“å‰<code>workInProgressHook</code>ï¼Œå¯¹åº”çš„<code>currentHooks</code>ï¼Œç„¶åå¤åˆ¶ä¸€ä»½<code>currentHooks</code>ç»™<code>workInProgressHook</code>,æ¥ä¸‹æ¥<code>hooks</code>å‡½æ•°æ‰§è¡Œçš„æ—¶å€™,æŠŠæœ€æ–°çš„çŠ¶æ€æ›´æ–°åˆ°<code>workInProgressHook</code>ï¼Œä¿è¯<code>hooks</code>çŠ¶æ€ä¸ä¸¢å¤±ã€‚</p> <p>æ‰€ä»¥å‡½æ•°ç»„ä»¶æ¯æ¬¡æ›´æ–°ï¼Œæ¯ä¸€æ¬¡<code>react-hooks</code>å‡½æ•°æ‰§è¡Œï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ªå‡½æ•°å»åšä¸Šé¢çš„æ“ä½œï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯<code>updateWorkInProgressHook</code>,æˆ‘ä»¬æ¥ä¸‹æ¥ä¸€èµ·çœ‹è¿™ä¸ª<code>updateWorkInProgressHook</code>ã€‚</p> <h3 id="_1-updateworkinprogresshook"><a href="#_1-updateworkinprogresshook" class="header-anchor">#</a> 1 updateWorkInProgressHook</h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> nextCurrentHook<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/* å¦‚æœ currentHook = null è¯æ˜å®ƒæ˜¯ç¬¬ä¸€ä¸ªhooks */</span>
    <span class="token keyword">const</span> current <span class="token operator">=</span> currentlyRenderingFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nextCurrentHook <span class="token operator">=</span> current<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      nextCurrentHook <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">/* ä¸æ˜¯ç¬¬ä¸€ä¸ªhooksï¼Œé‚£ä¹ˆæŒ‡å‘ä¸‹ä¸€ä¸ª hooks */</span>
    nextCurrentHook <span class="token operator">=</span> currentHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> nextWorkInProgressHook
  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//ç¬¬ä¸€æ¬¡æ‰§è¡Œhooks</span>
    <span class="token comment">// è¿™é‡Œåº”è¯¥æ³¨æ„ä¸€ä¸‹ï¼Œå½“å‡½æ•°ç»„ä»¶æ›´æ–°ä¹Ÿæ˜¯è°ƒç”¨ renderWithHooks ,memoizedStateå±æ€§æ˜¯ç½®ç©ºçš„</span>
    nextWorkInProgressHook <span class="token operator">=</span> currentlyRenderingFiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
    nextWorkInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>nextWorkInProgressHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token comment">/* è¿™ä¸ªæƒ…å†µè¯´æ˜ renderWithHooks æ‰§è¡Œ è¿‡ç¨‹å‘ç”Ÿå¤šæ¬¡å‡½æ•°ç»„ä»¶çš„æ‰§è¡Œ ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸è€ƒè™‘ */</span>
    workInProgressHook <span class="token operator">=</span> nextWorkInProgressHook<span class="token punctuation">;</span>
    nextWorkInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    currentHook <span class="token operator">=</span> nextCurrentHook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>
      nextCurrentHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token string">'Rendered more hooks than during the previous render.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentHook <span class="token operator">=</span> nextCurrentHook<span class="token punctuation">;</span>
    <span class="token keyword">const</span> newHook <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„hook</span>
      <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span>
      <span class="token literal-property property">baseState</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>baseState<span class="token punctuation">,</span>
      <span class="token literal-property property">baseQueue</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>baseQueue<span class="token punctuation">,</span>
      <span class="token literal-property property">queue</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>queue<span class="token punctuation">,</span>
      <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªhooks</span>
      currentlyRenderingFiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> workInProgressHook <span class="token operator">=</span> newHook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// é‡æ–°æ›´æ–° hook</span>
      workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> newHook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸€æ®µçš„é€»è¾‘å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p> <ul><li><p>é¦–å…ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ<code>hooks</code>å‡½æ•°ï¼Œé‚£ä¹ˆä»<code>current</code>æ ‘ä¸Šå–å‡º<code>memoizedState</code> ï¼Œä¹Ÿå°±æ˜¯æ—§çš„<code>hooks</code>ã€‚</p></li> <li><p>ç„¶åå£°æ˜å˜é‡<code>nextWorkInProgressHook</code>ï¼Œè¿™é‡Œåº”è¯¥å€¼å¾—æ³¨æ„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€æ¬¡<code>renderWithHooks</code>æ‰§è¡Œï¼Œ<code>workInProgress</code>ä¸Šçš„<code>memoizedState</code>ä¼šè¢«ç½®ç©ºï¼Œ<code>hooks</code>å‡½æ•°é¡ºåºæ‰§è¡Œï¼Œ<code>nextWorkInProgressHook</code>åº”è¯¥ä¸€ç›´ä¸º<code>null</code>ï¼Œé‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹<code>nextWorkInProgressHook</code>ä¸ä¸º<code>null</code>,ä¹Ÿå°±æ˜¯å½“ä¸€æ¬¡<code>renderWithHooks</code>æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†å¤šæ¬¡å‡½æ•°ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>renderWithHooks</code>ä¸­è¿™æ®µé€»è¾‘ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ....è¿™é‡Œçš„é€»è¾‘æˆ‘ä»¬å…ˆæ”¾ä¸€æ”¾  }</span>
</code></pre></div></li></ul> <p>è¿™é‡Œé¢çš„é€»è¾‘ï¼Œå®é™…å°±æ˜¯åˆ¤å®šï¼Œå¦‚æœå½“å‰å‡½æ•°ç»„ä»¶æ‰§è¡Œåï¼Œå½“å‰å‡½æ•°ç»„ä»¶çš„è¿˜æ˜¯å¤„äºæ¸²æŸ“ä¼˜å…ˆçº§ï¼Œè¯´æ˜å‡½æ•°ç»„ä»¶åˆæœ‰äº†æ–°çš„æ›´æ–°ä»»åŠ¡ï¼Œé‚£ä¹ˆå¾ªåæ‰§è¡Œå‡½æ•°ç»„ä»¶ã€‚è¿™å°±é€ æˆäº†ä¸Šè¿°çš„ï¼Œ<code>nextWorkInProgressHook</code>ä¸ä¸º <code>null</code> çš„æƒ…å†µã€‚</p> <ul><li>æœ€åå¤åˆ¶<code>current</code>çš„<code>hooks</code>ï¼ŒæŠŠå®ƒèµ‹å€¼ç»™<code>workInProgressHook</code>,ç”¨äºæ›´æ–°æ–°çš„ä¸€è½®<code>hooks</code>çŠ¶æ€ã€‚</li></ul> <p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å››ä¸ªç§ç±»çš„<code>hooks</code>ï¼Œåœ¨ä¸€æ¬¡ç»„ä»¶æ›´æ–°ä¸­ï¼Œåˆ†åˆ«åšäº†é‚£äº›æ“ä½œã€‚</p> <h3 id="_2-updatestate"><a href="#_2-updatestate" class="header-anchor">#</a> 2 updateState</h3> <p><strong>useState</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateReducer</span><span class="token punctuation">(</span>
  <span class="token parameter">reducer<span class="token punctuation">,</span>
  initialArg<span class="token punctuation">,</span>
  init<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> queue <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">;</span>
  queue<span class="token punctuation">.</span>lastRenderedReducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span>
  <span class="token keyword">const</span> current <span class="token operator">=</span> currentHook<span class="token punctuation">;</span>
  <span class="token keyword">let</span> baseQueue <span class="token operator">=</span> current<span class="token punctuation">.</span>baseQueue<span class="token punctuation">;</span>
  <span class="token keyword">const</span> pendingQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// è¿™é‡Œçœç•¥... ç¬¬ä¸€æ­¥ï¼šå°† pending  queue åˆå¹¶åˆ° basequeue</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>baseQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> first <span class="token operator">=</span> baseQueue<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token keyword">let</span> newState <span class="token operator">=</span> current<span class="token punctuation">.</span>baseState<span class="token punctuation">;</span>
    <span class="token keyword">let</span> newBaseState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newBaseQueueFirst <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newBaseQueueLast <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> update <span class="token operator">=</span> first<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> updateExpirationTime <span class="token operator">=</span> update<span class="token punctuation">.</span>expirationTime<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>updateExpirationTime <span class="token operator">&lt;</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//ä¼˜å…ˆçº§ä¸è¶³</span>
        <span class="token keyword">const</span> clone  <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">expirationTime</span><span class="token operator">:</span> update<span class="token punctuation">.</span>expirationTime<span class="token punctuation">,</span>
          <span class="token operator">...</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          newBaseQueueFirst <span class="token operator">=</span> newBaseQueueLast <span class="token operator">=</span> clone<span class="token punctuation">;</span>
          newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          newBaseQueueLast <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">//æ­¤æ›´æ–°ç¡®å®å…·æœ‰è¶³å¤Ÿçš„ä¼˜å…ˆçº§ã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> clone<span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">expirationTime</span><span class="token operator">:</span> Sync<span class="token punctuation">,</span> 
             <span class="token operator">...</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          newBaseQueueLast <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* å¾—åˆ°æ–°çš„ state */</span>
        newState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      update <span class="token operator">=</span> update<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>update <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> update <span class="token operator">!==</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> newBaseQueueFirst<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
    hook<span class="token punctuation">.</span>baseState <span class="token operator">=</span> newBaseState<span class="token punctuation">;</span>
    hook<span class="token punctuation">.</span>baseQueue <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">;</span>
    queue<span class="token punctuation">.</span>lastRenderedState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> queue<span class="token punctuation">.</span>dispatch
  <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸€æ®µçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œè®©æˆ‘ä»¬æ…¢æ…¢åƒé€ï¼Œé¦–å…ˆå°†ä¸Šä¸€æ¬¡æ›´æ–°çš„<code>pending queue</code> åˆå¹¶åˆ° <code>basequeue</code>ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ä¸­è¿™ä¹ˆå†™ï¼Œ</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span>setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token keyword">const</span> <span class="token function-variable function">handerClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//    setNumber(1)</span>
    <span class="token comment">//    setNumber(2)</span>
    <span class="token comment">//    setNumber(3)</span>
       <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token comment">// è·å–ä¸Šæ¬¡ state = 1 </span>
       <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token comment">// è·å–ä¸Šæ¬¡ state = 2</span>
       <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token comment">// 3 </span>
   <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span> number <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">handerClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>ç‚¹å‡»<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ç‚¹å‡»æŒ‰é’®ï¼Œ æ‰“å° 3</strong></p> <p>ä¸‰æ¬¡<code>setNumber</code>äº§ç”Ÿçš„<code>update</code>ä¼šæš‚ä¸”æ”¾å…¥<code>pending queue</code>ï¼Œåœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œæ—¶å€™ï¼Œä¸‰æ¬¡ <code>update</code>è¢«åˆå¹¶åˆ° <code>baseQueue</code>ã€‚ç»“æ„å¦‚ä¸‹å›¾ï¼š</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9vwXvsCcoplj6QDeCF87W4UsmHT8WfbUoV7V6LUCJ7hJrBOib9gw2cvQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>æ¥ä¸‹æ¥ä¼šæŠŠå½“å‰<code>useState</code>æˆ–æ˜¯<code>useReduer</code>å¯¹åº”çš„<code>hooks</code>ä¸Šçš„<code>baseState</code>å’Œ<code>baseQueue</code>æ›´æ–°åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚ä¼šå¾ªç¯<code>baseQueue</code>çš„<code>update</code>ï¼Œå¤åˆ¶ä¸€ä»½<code>update</code>,æ›´æ–° <code>expirationTime</code>ï¼Œå¯¹äºæœ‰è¶³å¤Ÿä¼˜å…ˆçº§çš„<code>update</code>ï¼ˆä¸Šè¿°ä¸‰ä¸ª<code>setNumber</code>äº§ç”Ÿçš„<code>update</code>éƒ½å…·æœ‰è¶³å¤Ÿçš„ä¼˜å…ˆçº§ï¼‰ï¼Œæˆ‘ä»¬è¦è·å–æœ€æ–°çš„<code>state</code>çŠ¶æ€ã€‚ï¼Œä¼šä¸€æ¬¡æ‰§è¡Œ<code>useState</code>ä¸Šçš„æ¯ä¸€ä¸ª<code>action</code>ã€‚å¾—åˆ°æœ€æ–°çš„<code>state</code>ã€‚</p> <p><strong>æ›´æ–°state</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9K7HjGf6G85JRwTic19FwibN9VqXCwjiaMPwrIniccPlwDm9jtibKG9ghZqQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>è¿™é‡Œæœ‰ä¼šæœ‰ä¸¤ä¸ªç–‘é—®ğŸ¤”ï¸:</p> <ul><li>é—®é¢˜ä¸€ï¼šè¿™é‡Œä¸æ˜¯æ‰§è¡Œæœ€åä¸€ä¸ª<code>action</code>ä¸å°±å¯ä»¥äº†å˜›?</li></ul> <p>ç­”æ¡ˆï¼šåŸå› å¾ˆç®€å•ï¼Œä¸Šé¢è¯´äº† <code>useState</code>é€»è¾‘å’Œ<code>useReducer</code>å·®ä¸å¤šã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šå¼•ç”¨ä¸Šä¸€æ¬¡ <code>update</code>äº§ç”Ÿçš„ <code>state</code>, æ‰€ä»¥éœ€è¦<strong>å¾ªç¯è°ƒç”¨ï¼Œæ¯ä¸€ä¸ª<code>update</code>çš„<code>reducer</code></strong>ï¼Œå¦‚æœ<code>setNumber(2)</code>æ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåªç”¨æ›´æ–°å€¼ï¼Œå¦‚æœæ˜¯<code>setNumber(state=&gt;state+1)</code>,é‚£ä¹ˆä¼ å…¥ä¸Šä¸€æ¬¡çš„ <code>state</code> å¾—åˆ°æœ€æ–°<code>state</code>ã€‚</p> <ul><li>é—®é¢˜äºŒï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šæœ‰ä¼˜å…ˆçº§ä¸è¶³çš„æƒ…å†µ(<code>updateExpirationTime &lt; renderExpirationTime</code>)ï¼Ÿ</li></ul> <p>ç­”æ¡ˆï¼šè¿™ç§æƒ…å†µï¼Œä¸€èˆ¬ä¼šå‘ç”Ÿåœ¨ï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>setNumber</code>æ—¶å€™ï¼Œè°ƒç”¨<code>scheduleUpdateOnFiber</code>æ¸²æŸ“å½“å‰ç»„ä»¶æ—¶ï¼Œåˆäº§ç”Ÿäº†ä¸€æ¬¡æ–°çš„æ›´æ–°ï¼Œæ‰€ä»¥æŠŠæœ€ç»ˆæ‰§è¡Œ<code>reducer</code>æ›´æ–°<code>state</code>ä»»åŠ¡äº¤ç»™ä¸‹ä¸€æ¬¡æ›´æ–°ã€‚</p> <h3 id="_3-updateeffect"><a href="#_3-updateeffect" class="header-anchor">#</a> 3 updateEffect</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateEffect</span><span class="token punctuation">(</span><span class="token parameter">create<span class="token punctuation">,</span> deps</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span>
  <span class="token keyword">let</span> destroy <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> prevEffect <span class="token operator">=</span> currentHook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
    destroy <span class="token operator">=</span> prevEffect<span class="token punctuation">.</span>destroy<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextDeps <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> prevDeps <span class="token operator">=</span> prevEffect<span class="token punctuation">.</span>deps<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">areHookInputsEqual</span><span class="token punctuation">(</span>nextDeps<span class="token punctuation">,</span> prevDeps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">pushEffect</span><span class="token punctuation">(</span>hookEffectTag<span class="token punctuation">,</span> create<span class="token punctuation">,</span> destroy<span class="token punctuation">,</span> nextDeps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  currentlyRenderingFiber<span class="token punctuation">.</span>effectTag <span class="token operator">|=</span> fiberEffectTag
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token function">pushEffect</span><span class="token punctuation">(</span>
    HookHasEffect <span class="token operator">|</span> hookEffectTag<span class="token punctuation">,</span>
    create<span class="token punctuation">,</span>
    destroy<span class="token punctuation">,</span>
    nextDeps<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>useEffect</code> åšçš„äº‹å¾ˆç®€å•ï¼Œåˆ¤æ–­ä¸¤æ¬¡<code>deps</code> ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰è¯´æ˜æ­¤æ¬¡æ›´æ–°ä¸éœ€è¦æ‰§è¡Œï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>pushEffect</code>,è¿™é‡Œæ³¨æ„ <code>effect</code>çš„æ ‡ç­¾ï¼Œ<code>hookEffectTag</code>,å¦‚æœä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆæ›´æ–° <code>effect</code> ,å¹¶ä¸”èµ‹å€¼ç»™<code>hook.memoizedState</code>ï¼Œè¿™é‡Œæ ‡ç­¾æ˜¯ <code>HookHasEffect | hookEffectTag</code>,ç„¶ååœ¨<code>commit</code>é˜¶æ®µï¼Œ<code>react</code>ä¼šé€šè¿‡æ ‡ç­¾æ¥åˆ¤æ–­ï¼Œæ˜¯å¦æ‰§è¡Œå½“å‰çš„ <code>effect</code> å‡½æ•°ã€‚</p> <h3 id="_4-updatememo"><a href="#_4-updatememo" class="header-anchor">#</a> 4 updateMemo</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateMemo</span><span class="token punctuation">(</span>
  <span class="token parameter">nextCreate<span class="token punctuation">,</span>
  deps<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span> <span class="token comment">// æ–°çš„ deps å€¼</span>
  <span class="token keyword">const</span> prevState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span> 
  <span class="token keyword">if</span> <span class="token punctuation">(</span>prevState <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextDeps <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> prevDeps <span class="token operator">=</span> prevState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ä¹‹å‰ä¿å­˜çš„ deps å€¼</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">areHookInputsEqual</span><span class="token punctuation">(</span>nextDeps<span class="token punctuation">,</span> prevDeps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//åˆ¤æ–­ä¸¤æ¬¡ deps å€¼</span>
        <span class="token keyword">return</span> prevState<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> nextValue <span class="token operator">=</span> <span class="token function">nextCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token punctuation">[</span>nextValue<span class="token punctuation">,</span> nextDeps<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> nextValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ç»„ä»¶æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œ<code>useMemo</code>å‡½æ•°ï¼Œåšçš„äº‹æƒ…å®é™…å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­ä¸¤æ¬¡ <code>deps</code>æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸æƒ³ç­‰ï¼Œè¯æ˜ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆæ‰§è¡Œ <code>useMemo</code>çš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¾—åˆ°æ–°çš„å€¼ï¼Œç„¶åé‡æ–°èµ‹å€¼ç»™<code>hook.memoizedState</code>,å¦‚æœç›¸ç­‰ è¯æ˜æ²¡æœ‰ä¾èµ–é¡¹æ”¹å˜ï¼Œé‚£ä¹ˆç›´æ¥è·å–ç¼“å­˜çš„å€¼ã€‚</p> <p>ä¸è¿‡è¿™é‡Œæœ‰ä¸€ç‚¹ï¼Œå€¼å¾—æ³¨æ„ï¼Œ<code>nextCreate()</code>æ‰§è¡Œï¼Œå¦‚æœé‡Œé¢å¼•ç”¨äº†<code>usestate</code>ç­‰ä¿¡æ¯ï¼Œå˜é‡ä¼šè¢«å¼•ç”¨ï¼Œæ— æ³•è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼Œå°±æ˜¯é—­åŒ…åŸç†ï¼Œé‚£ä¹ˆè®¿é—®çš„å±æ€§æœ‰å¯èƒ½ä¸æ˜¯æœ€æ–°çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦æŠŠå¼•ç”¨çš„å€¼ï¼Œæ·»åŠ åˆ°ä¾èµ–é¡¹ <code>dep</code> æ•°ç»„ä¸­ã€‚æ¯ä¸€æ¬¡<code>dep</code>æ”¹å˜ï¼Œé‡æ–°æ‰§è¡Œï¼Œå°±ä¸ä¼šå‡ºç°é—®é¢˜äº†ã€‚</p> <p><strong>æ¸©é¦¨å°æç¤ºï¼šæœ‰å¾ˆå¤šåŒå­¦è¯´ <code>useMemo</code>æ€ä¹ˆç”¨ï¼Œåˆ°åº•ä»€ä¹ˆåœºæ™¯ç”¨ï¼Œç”¨äº†ä¼šä¸ä¼šèµ·åˆ°åä½œç”¨ï¼Œé€šè¿‡å¯¹æºç åŸç†è§£æï¼Œæˆ‘å¯ä»¥æ˜ç¡®çš„è¯´ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼Œè¯´ç™½äº†å°±æ˜¯å¯ä»¥å®šåˆ¶åŒ–ç¼“å­˜ï¼Œå­˜å€¼å–å€¼è€Œå·²ã€‚</strong></p> <h2 id="_5-updateref"><a href="#_5-updateref" class="header-anchor">#</a> 5 updateRef</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateRef</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> hook<span class="token punctuation">.</span>memoizedState
<span class="token punctuation">}</span>
</code></pre></div><p>å‡½æ•°ç»„ä»¶æ›´æ–°useRefåšçš„äº‹æƒ…æ›´ç®€å•ï¼Œå°±æ˜¯è¿”å›äº†ç¼“å­˜ä¸‹æ¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ— è®ºå‡½æ•°ç»„ä»¶æ€ä¹ˆæ‰§è¡Œï¼Œæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œ<code>hook.memoizedState</code>å†…å­˜ä¸­éƒ½æŒ‡å‘äº†ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è§£é‡Šäº†<code>useEffect</code>,<code>useMemo</code> ä¸­ï¼Œä¸ºä»€ä¹ˆ<code>useRef</code>ä¸éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå°±èƒ½è®¿é—®åˆ°æœ€æ–°çš„æ”¹å˜å€¼ã€‚</p> <h2 id="ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶æ›´æ–°"><a href="#ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶æ›´æ–°" class="header-anchor">#</a> ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶æ›´æ–°</h2> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdx8qFekwZcicez5AIibeMzZf9Xte0iaxFJbKFFE9GaSu3xUkMMWjcvH8NOnEY9adx6ggxCibQt178q7HA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h1 id="äº”-æ€»ç»“"><a href="#äº”-æ€»ç»“" class="header-anchor">#</a> äº” æ€»ç»“</h1> <p>ä¸Šé¢æˆ‘ä»¬ä»<strong>å‡½æ•°ç»„ä»¶åˆå§‹åŒ–</strong>ï¼Œåˆ°<strong>å‡½æ•°ç»„ä»¶æ›´æ–°æ¸²æŸ“</strong>ï¼Œä¸¤ä¸ªç»´åº¦åˆ†è§£è®²è§£äº†<code>react-hooks</code>åŸç†ï¼ŒæŒæ¡äº†<code>react-hooks</code>åŸç†å’Œå†…éƒ¨è¿è¡Œæœºåˆ¶ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨å·¥ä½œä¸­ï¼Œæ›´å¥½çš„ä½¿ç”¨<code>react-hooks</code>ã€‚</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">11/8/2024, 10:19:43 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/react/3-hooks/memoå’ŒuseMemoçš„ç”¨æ³•ä¸åŒºåˆ«.html" class="prev">
        React.memo() å’Œ useMemo() çš„ç”¨æ³•ä¸åŒºåˆ«
      </a></span> <span class="next"><a href="/react/3-hooks/ä¸è¦å†æ»¥ç”¨useMemoäº†.html">
        ä¸è¦å†æ»¥ç”¨useMemoäº†ï¼ä½ åº”è¯¥é‡æ–°æ€è€ƒHooks memoization
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.447fea52.js" defer></script><script src="/assets/js/2.57da4f88.js" defer></script><script src="/assets/js/1.a76cc220.js" defer></script><script src="/assets/js/151.fc9a2f7e.js" defer></script>
  </body>
</html>
