(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{455:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"react-事件机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-事件机制"}},[t._v("#")]),t._v(" React 事件机制")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"http://www.conardli.top/blog/article/React%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97/React%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6.html#react%E4%BA%8B%E4%BB%B6%E5%92%8C%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.conardli.top/blog/article/React 深入系列/React 事件机制.html#react 事件和原生事件的执行顺序"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"关于-react-事件的疑问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于-react-事件的疑问"}},[t._v("#")]),t._v(" 关于 React 事件的疑问")]),t._v(" "),a("ul",[a("li",[t._v("1.为什么要手动绑定"),a("code",[t._v("this")])]),t._v(" "),a("li",[t._v("2."),a("code",[t._v("React")]),t._v("事件和原生事件有什么区别")]),t._v(" "),a("li",[t._v("3."),a("code",[t._v("React")]),t._v("事件和原生事件的执行顺序，可以混用吗")]),t._v(" "),a("li",[t._v("4."),a("code",[t._v("React")]),t._v("事件如何解决跨浏览器兼容")]),t._v(" "),a("li",[t._v("5.什么是合成事件")])]),t._v(" "),a("p",[t._v("下面是我阅读过源码后，将所有的执行流程总结出来的流程图，不会贴代码，如果你想阅读代码看看具体是如何实现的，可以根据流程图去源码里寻找。")]),t._v(" "),a("h2",{attrs:{id:"事件注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件注册"}},[t._v("#")]),t._v(" 事件注册")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/%E4%BA%8B%E4%BB%B6%E6%B3%A8%E5%86%8C.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("组件装载 / 更新。")]),t._v(" "),a("li",[t._v("通过"),a("code",[t._v("lastProps")]),t._v("、"),a("code",[t._v("nextProps")]),t._v("判断是否新增、删除事件分别调用事件注册、卸载方法。")]),t._v(" "),a("li",[t._v("调用"),a("code",[t._v("EventPluginHub")]),t._v("的"),a("code",[t._v("enqueuePutListener")]),t._v("进行事件存储")]),t._v(" "),a("li",[t._v("获取"),a("code",[t._v("document")]),t._v("对象。")]),t._v(" "),a("li",[t._v("根据事件名称（如"),a("code",[t._v("onClick")]),t._v("、"),a("code",[t._v("onCaptureClick")]),t._v("）判断是进行冒泡还是捕获。")]),t._v(" "),a("li",[t._v("判断是否存在"),a("code",[t._v("addEventListener")]),t._v("方法，否则使用"),a("code",[t._v("attachEvent")]),t._v("（兼容 IE）。")]),t._v(" "),a("li",[t._v("给"),a("code",[t._v("document")]),t._v("注册原生事件回调为"),a("code",[t._v("dispatchEvent")]),t._v("（统一的事件分发机制）。")])]),t._v(" "),a("h2",{attrs:{id:"事件存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件存储"}},[t._v("#")]),t._v(" 事件存储")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/%E4%BA%8B%E4%BB%B6%E5%AD%98%E5%82%A8.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[a("code",[t._v("EventPluginHub")]),t._v("负责管理 React 合成事件的"),a("code",[t._v("callback")]),t._v("，它将"),a("code",[t._v("callback")]),t._v("存储在"),a("code",[t._v("listenerBank")]),t._v("中，另外还存储了负责合成事件的"),a("code",[t._v("Plugin")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("EventPluginHub")]),t._v("的"),a("code",[t._v("putListener")]),t._v("方法是向存储容器中增加一个 listener。")]),t._v(" "),a("li",[t._v("获取绑定事件的元素的唯一标识"),a("code",[t._v("key")]),t._v("。")]),t._v(" "),a("li",[t._v("将"),a("code",[t._v("callback")]),t._v("根据事件类型，元素的唯一标识"),a("code",[t._v("key")]),t._v("存储在"),a("code",[t._v("listenerBank")]),t._v("中。")]),t._v(" "),a("li",[a("code",[t._v("listenerBank")]),t._v("的结构是："),a("code",[t._v("listenerBank[registrationName][key]")]),t._v("。")])]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("{\n    onClick:{\n        nodeid1:()=>{...}\n        nodeid2:()=>{...}\n    },\n    onChange:{\n        nodeid3:()=>{...}\n        nodeid4:()=>{...}\n    }\n}\n")])])]),a("h2",{attrs:{id:"事件触发-执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件触发-执行"}},[t._v("#")]),t._v(" 事件触发 / 执行")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91.png",alt:"image"}})]),t._v(" "),a("p",[t._v("这里的事件执行利用了"),a("code",[t._v("React")]),t._v("的批处理机制，在前一篇的【React 深入】setState 执行机制中已经分析过，这里不再多加分析。")]),t._v(" "),a("ul",[a("li",[t._v("触发"),a("code",[t._v("document")]),t._v("注册原生事件的回调"),a("code",[t._v("dispatchEvent")])]),t._v(" "),a("li",[t._v("获取到触发这个事件最深一级的元素")])]),t._v(" "),a("p",[t._v("例如下面的代码：首先会获取到"),a("code",[t._v("this.child")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div onClick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parentClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div onClick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    test\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("ul",[a("li",[t._v("遍历这个元素的所有父元素，依次对每一级元素进行处理。")]),t._v(" "),a("li",[t._v("构造合成事件。")]),t._v(" "),a("li",[t._v("将每一级的合成事件存储在"),a("code",[t._v("eventQueue")]),t._v("事件队列中。")]),t._v(" "),a("li",[t._v("遍历"),a("code",[t._v("eventQueue")]),t._v("。")]),t._v(" "),a("li",[t._v("通过"),a("code",[t._v("isPropagationStopped")]),t._v("判断当前事件是否执行了阻止冒泡方法。")]),t._v(" "),a("li",[t._v("如果阻止了冒泡，停止遍历，否则通过"),a("code",[t._v("executeDispatch")]),t._v("执行合成事件。")]),t._v(" "),a("li",[t._v("释放处理完成的事件。")])]),t._v(" "),a("p",[a("code",[t._v("react")]),t._v("在自己的合成事件中重写了"),a("code",[t._v("stopPropagation")]),t._v("方法，将"),a("code",[t._v("isPropagationStopped")]),t._v("设置为"),a("code",[t._v("true")]),t._v("，然后在遍历每一级事件的过程中根据此遍历判断是否继续执行。这就是"),a("code",[t._v("react")]),t._v("自己实现的冒泡机制。")]),t._v(" "),a("h2",{attrs:{id:"合成事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合成事件"}},[t._v("#")]),t._v(" 合成事件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6.png",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("调用"),a("code",[t._v("EventPluginHub")]),t._v("的"),a("code",[t._v("extractEvents")]),t._v("方法。")]),t._v(" "),a("li",[t._v("循环所有类型的"),a("code",[t._v("EventPlugin")]),t._v("（用来处理不同事件的工具方法）。")]),t._v(" "),a("li",[t._v("在每个"),a("code",[t._v("EventPlugin")]),t._v("中根据不同的事件类型，返回不同的事件池。")]),t._v(" "),a("li",[t._v("在事件池中取出合成事件，如果事件池是空的，那么创建一个新的。")]),t._v(" "),a("li",[t._v("根据元素"),a("code",[t._v("nodeid")]),t._v("(唯一标识"),a("code",[t._v("key")]),t._v(")和事件类型从"),a("code",[t._v("listenerBink")]),t._v("中取出回调函数")]),t._v(" "),a("li",[t._v("返回带有合成事件参数的回调函数")])]),t._v(" "),a("h3",{attrs:{id:"总流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总流程"}},[t._v("#")]),t._v(" 总流程")]),t._v(" "),a("p",[t._v("将上面的四个流程串联起来。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/react%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6.png",alt:"image"}})]),t._v(" "),a("h2",{attrs:{id:"为什么要手动绑定-this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要手动绑定-this"}},[t._v("#")]),t._v(" 为什么要手动绑定 this")]),t._v(" "),a("p",[t._v("通过事件触发过程的分析，"),a("code",[t._v("dispatchEvent")]),t._v("调用了"),a("code",[t._v("invokeGuardedCallback")]),t._v("方法。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeGuardedCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("caughtError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      caughtError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("可见，回调函数是直接调用调用的，并没有指定调用的组件，所以不进行手动绑定的情况下直接获取到的"),a("code",[t._v("this")]),t._v("是"),a("code",[t._v("undefined")]),t._v("。")]),t._v(" "),a("p",[t._v("这里可以使用实验性的"),a("a",{attrs:{href:"https://babeljs.io/docs/en/babel-plugin-proposal-class-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("属性初始化语法"),a("OutboundLink")],1),t._v(" ，也就是直接在组件声明箭头函数。箭头函数不会创建自己的"),a("code",[t._v("this")]),t._v("，它只会从自己的作用域链的上一层继承"),a("code",[t._v("this")]),t._v("。因此这样我们在"),a("code",[t._v("React")]),t._v("事件中获取到的就是组件本身了。")]),t._v(" "),a("h2",{attrs:{id:"和原生事件有什么区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#和原生事件有什么区别"}},[t._v("#")]),t._v(" 和原生事件有什么区别")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("React")]),t._v(" 事件使用驼峰命名，而不是全部小写。")]),t._v(" "),a("li",[t._v("通过 "),a("code",[t._v("JSX")]),t._v(" , 你传递一个函数作为事件处理程序，而不是一个字符串。")])]),t._v(" "),a("p",[t._v("例如，"),a("code",[t._v("HTML")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button onclick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"activateLasers()"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Activate Lasers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("在 "),a("code",[t._v("React")]),t._v(" 中略有不同：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button onClick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("activateLasers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Activate Lasers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("另一个区别是，在 React 中你不能通过返回"),a("code",[t._v("false")]),t._v(" 来阻止默认行为。必须明确调用 "),a("code",[t._v("preventDefault")]),t._v("。")]),t._v(" "),a("p",[t._v("由上面执行机制我们可以得出："),a("code",[t._v("React")]),t._v("自己实现了一套事件机制，自己模拟了事件冒泡和捕获的过程，采用了事件代理，批量更新等方法，并且抹平了各个浏览器的兼容性问题。")]),t._v(" "),a("h2",{attrs:{id:"react事件和原生事件的执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react事件和原生事件的执行顺序"}},[t._v("#")]),t._v(" "),a("code",[t._v("React")]),t._v("事件和原生事件的执行顺序")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dom parent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dom child'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'document'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("childClick")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react child'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("parentClick")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react parent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div onClick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parentClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ref")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div onClick"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ref")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n          test\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("执行结果：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/reactEvent1.png",alt:"image"}})]),t._v(" "),a("p",[t._v("由上面的流程我们可以理解：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("react")]),t._v("的所有事件都挂载在"),a("code",[t._v("document")]),t._v("中")]),t._v(" "),a("li",[t._v("当真实 dom 触发后冒泡到"),a("code",[t._v("document")]),t._v("后才会对"),a("code",[t._v("react")]),t._v("事件进行处理")]),t._v(" "),a("li",[t._v("所以原生的事件会先执行")]),t._v(" "),a("li",[t._v("然后执行"),a("code",[t._v("react")]),t._v("合成事件")]),t._v(" "),a("li",[t._v("最后执行真正在"),a("code",[t._v("document")]),t._v("上挂载的事件")])]),t._v(" "),a("h1",{attrs:{id:"react-事件和原生事件可以混用吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-事件和原生事件可以混用吗"}},[t._v("#")]),t._v(" react 事件和原生事件可以混用吗？")]),t._v(" "),a("p",[a("code",[t._v("react")]),t._v("事件和原生事件最好不要混用。")]),t._v(" "),a("p",[t._v("原生事件中如果执行了"),a("code",[t._v("stopPropagation")]),t._v("方法，则会导致其他"),a("code",[t._v("react")]),t._v("事件失效。因为所有元素的事件将无法冒泡到"),a("code",[t._v("document")]),t._v("上。")]),t._v(" "),a("p",[t._v("由上面的执行机制不难得出，所有的 react 事件都将无法被注册。")]),t._v(" "),a("h2",{attrs:{id:"合成事件、浏览器兼容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合成事件、浏览器兼容"}},[t._v("#")]),t._v(" 合成事件、浏览器兼容")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  function handleClick(e) {\n    e.preventDefault();\n    console.log('The link was clicked.');\n  }\n")])])]),a("blockquote",[a("p",[t._v("这里， "),a("code",[t._v("e")]),t._v(" 是一个合成的事件。 "),a("code",[t._v("React")]),t._v(" 根据"),a("a",{attrs:{href:"https://www.w3.org/TR/DOM-Level-3-Events/",target:"_blank",rel:"noopener noreferrer"}},[t._v(" W3C "),a("OutboundLink")],1),t._v("规范 定义了这个合成事件，所以你不需要担心跨浏览器的兼容性问题。")])]),t._v(" "),a("p",[t._v("事件处理程序将传递 "),a("code",[t._v("SyntheticEvent")]),t._v(" 的实例，这是一个跨浏览器原生事件包装器。 它具有与浏览器原生事件相同的接口，包括"),a("code",[t._v("stopPropagation()")]),t._v(" 和 "),a("code",[t._v("preventDefault()")]),t._v(" ，在所有浏览器中他们工作方式都相同。")]),t._v(" "),a("p",[t._v("每个"),a("code",[t._v("SyntheticEvent")]),t._v("对象都具有以下属性：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("boolean bubbles\nboolean cancelable\nDOMEventTarget currentTarget\nboolean defaultPrevented\nnumber eventPhase\nboolean isTrusted\nDOMEvent nativeEvent\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("preventDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nboolean "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDefaultPrevented")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopPropagation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nboolean "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isPropagationStopped")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nDOMEventTarget target\nnumber timeStamp\nstring type\n")])])]),a("p",[a("code",[t._v("React")]),t._v("合成的"),a("code",[t._v("SyntheticEvent")]),t._v("采用了事件池，这样做可以大大节省内存，而不会频繁的创建和销毁事件对象。")]),t._v(" "),a("p",[t._v("另外，不管在什么浏览器环境下，浏览器会将该事件类型统一创建为合成事件，从而达到了浏览器兼容的目的。")])])}),[],!1,null,null,null);a.default=e.exports}}]);